<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.9.1">
  <compounddef id="walletdb_8cpp" kind="file" language="C++">
    <compoundname>walletdb.cpp</compoundname>
    <includes refid="walletdb_8h" local="yes">walletdb.h</includes>
    <includes refid="base58_8h" local="yes">base58.h</includes>
    <includes refid="protocol_8h" local="yes">protocol.h</includes>
    <includes refid="serialize_8h" local="yes">serialize.h</includes>
    <includes refid="sync_8h" local="yes">sync.h</includes>
    <includes refid="wallet_8h" local="yes">wallet.h</includes>
    <includes local="no">boost/filesystem.hpp</includes>
    <includes local="no">boost/foreach.hpp</includes>
    <incdepgraph>
      <node id="58716">
        <label>list</label>
      </node>
      <node id="58672">
        <label>boost/thread/mutex.hpp</label>
      </node>
      <node id="58767">
        <label>leveldb/write_batch.h</label>
        <link refid="write__batch_8h"/>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58765" relation="include">
        </childnode>
      </node>
      <node id="58738">
        <label>netinet/in.h</label>
      </node>
      <node id="58715">
        <label>amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58670" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
      </node>
      <node id="58739">
        <label>arpa/inet.h</label>
      </node>
      <node id="58680">
        <label>boost/thread/condition_variable.hpp</label>
      </node>
      <node id="58662">
        <label>limits</label>
      </node>
      <node id="58699">
        <label>crypto/sha256.h</label>
        <link refid="sha256_8h"/>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58670" relation="include">
        </childnode>
      </node>
      <node id="58745">
        <label>primitives/transaction.h</label>
        <link refid="transaction_8h"/>
        <childnode refid="58715" relation="include">
        </childnode>
        <childnode refid="58694" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58746" relation="include">
        </childnode>
        <childnode refid="58703" relation="include">
        </childnode>
        <childnode refid="58747" relation="include">
        </childnode>
        <childnode refid="58727" relation="include">
        </childnode>
      </node>
      <node id="58700">
        <label>crypto/argon2/blake2/blake2.h</label>
        <link refid="blake2_8h"/>
        <childnode refid="58701" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58674" relation="include">
        </childnode>
      </node>
      <node id="58703">
        <label>script.h</label>
        <link refid="script_8h"/>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58704" relation="include">
        </childnode>
        <childnode refid="58705" relation="include">
        </childnode>
        <childnode refid="58692" relation="include">
        </childnode>
        <childnode refid="58706" relation="include">
        </childnode>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58726" relation="include">
        </childnode>
      </node>
      <node id="58725">
        <label>openssl/rand.h</label>
      </node>
      <node id="58654">
        <label>walletdb.h</label>
        <link refid="walletdb_8h"/>
        <childnode refid="58655" relation="include">
        </childnode>
        <childnode refid="58690" relation="include">
        </childnode>
        <childnode refid="58726" relation="include">
        </childnode>
        <childnode refid="58715" relation="include">
        </childnode>
        <childnode refid="58716" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58687" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58685">
        <label>assert.h</label>
      </node>
      <node id="58667">
        <label>boost/tuple/tuple.hpp</label>
      </node>
      <node id="58737">
        <label>net/if.h</label>
      </node>
      <node id="58756">
        <label>txmempool.h</label>
        <link refid="txmempool_8h"/>
        <childnode refid="58745" relation="include">
        </childnode>
        <childnode refid="58678" relation="include">
        </childnode>
        <childnode refid="58757" relation="include">
        </childnode>
        <childnode refid="58715" relation="include">
        </childnode>
        <childnode refid="58769" relation="include">
        </childnode>
      </node>
      <node id="58766">
        <label>leveldb/options.h</label>
        <link refid="options_8h"/>
        <childnode refid="58701" relation="include">
        </childnode>
      </node>
      <node id="58682">
        <label>boost/thread/recursive_mutex.hpp</label>
      </node>
      <node id="58730">
        <label>base58.h</label>
        <link refid="base58_8h"/>
        <childnode refid="58731" relation="include">
        </childnode>
        <childnode refid="58692" relation="include">
        </childnode>
        <childnode refid="58691" relation="include">
        </childnode>
        <childnode refid="58703" relation="include">
        </childnode>
        <childnode refid="58668" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58676">
        <label>version.h</label>
        <link refid="version_8h"/>
        <childnode refid="58677" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
      </node>
      <node id="58757">
        <label>coins.h</label>
        <link refid="coins_8h"/>
        <childnode refid="58758" relation="include">
        </childnode>
        <childnode refid="58756" relation="include">
        </childnode>
        <childnode refid="58685" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58704" relation="include">
        </childnode>
        <childnode refid="58768" relation="include">
        </childnode>
      </node>
      <node id="58673">
        <label>sys/mman.h</label>
      </node>
      <node id="58670">
        <label>stdlib.h</label>
      </node>
      <node id="58770">
        <label>chain.h</label>
        <link refid="chain_8h"/>
        <childnode refid="58744" relation="include">
        </childnode>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58731" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58704" relation="include">
        </childnode>
      </node>
      <node id="58704">
        <label>boost/foreach.hpp</label>
      </node>
      <node id="58724">
        <label>openssl/crypto.h</label>
      </node>
      <node id="58734">
        <label>compat.h</label>
        <link refid="compat_8h"/>
        <childnode refid="58735" relation="include">
        </childnode>
        <childnode refid="58673" relation="include">
        </childnode>
        <childnode refid="58736" relation="include">
        </childnode>
        <childnode refid="58709" relation="include">
        </childnode>
        <childnode refid="58737" relation="include">
        </childnode>
        <childnode refid="58738" relation="include">
        </childnode>
        <childnode refid="58739" relation="include">
        </childnode>
        <childnode refid="58740" relation="include">
        </childnode>
        <childnode refid="58674" relation="include">
        </childnode>
        <childnode refid="58741" relation="include">
        </childnode>
        <childnode refid="58675" relation="include">
        </childnode>
        <childnode refid="58742" relation="include">
        </childnode>
      </node>
      <node id="58720">
        <label>boost/date_time/posix_time/posix_time_types.hpp</label>
      </node>
      <node id="58696">
        <label>openssl/sha.h</label>
      </node>
      <node id="58742">
        <label>errno.h</label>
      </node>
      <node id="58661">
        <label>cassert</label>
      </node>
      <node id="58695">
        <label>stdexcept</label>
      </node>
      <node id="58708">
        <label>util.h</label>
        <link refid="util_8h"/>
        <childnode refid="58709" relation="include">
        </childnode>
        <childnode refid="58710" relation="include">
        </childnode>
        <childnode refid="58711" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58712" relation="include">
        </childnode>
        <childnode refid="58715" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58716" relation="include">
        </childnode>
        <childnode refid="58687" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58717" relation="include">
        </childnode>
        <childnode refid="58718" relation="include">
        </childnode>
        <childnode refid="58688" relation="include">
        </childnode>
        <childnode refid="58719" relation="include">
        </childnode>
        <childnode refid="58720" relation="include">
        </childnode>
        <childnode refid="58721" relation="include">
        </childnode>
        <childnode refid="58722" relation="include">
        </childnode>
        <childnode refid="58723" relation="include">
        </childnode>
        <childnode refid="58724" relation="include">
        </childnode>
        <childnode refid="58725" relation="include">
        </childnode>
        <childnode refid="58707" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
      </node>
      <node id="58732">
        <label>protocol.h</label>
        <link refid="protocol_8h"/>
        <childnode refid="58731" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58733" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
      </node>
      <node id="58719">
        <label>boost/date_time/gregorian/gregorian_types.hpp</label>
      </node>
      <node id="58762">
        <label>leveldb/db.h</label>
        <link refid="leveldb_2include_2leveldb_2db_8h"/>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58727" relation="include">
        </childnode>
        <childnode refid="58763" relation="include">
        </childnode>
        <childnode refid="58766" relation="include">
        </childnode>
      </node>
      <node id="58657">
        <label>string</label>
      </node>
      <node id="58743">
        <label>wallet.h</label>
        <link refid="wallet_8h"/>
        <childnode refid="58654" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58670" relation="include">
        </childnode>
        <childnode refid="58744" relation="include">
        </childnode>
        <childnode refid="58745" relation="include">
        </childnode>
        <childnode refid="58754" relation="include">
        </childnode>
        <childnode refid="58755" relation="include">
        </childnode>
        <childnode refid="58691" relation="include">
        </childnode>
        <childnode refid="58690" relation="include">
        </childnode>
        <childnode refid="58703" relation="include">
        </childnode>
        <childnode refid="58771" relation="include">
        </childnode>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58726" relation="include">
        </childnode>
      </node>
      <node id="58748">
        <label>scrypt.h</label>
        <link refid="scrypt_8h"/>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58670" relation="include">
        </childnode>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58749" relation="include">
        </childnode>
      </node>
      <node id="58659">
        <label>map</label>
      </node>
      <node id="58717">
        <label>boost/thread.hpp</label>
      </node>
      <node id="58753">
        <label>addrman.h</label>
        <link refid="addrman_8h"/>
        <childnode refid="58733" relation="include">
        </childnode>
        <childnode refid="58732" relation="include">
        </childnode>
        <childnode refid="58678" relation="include">
        </childnode>
        <childnode refid="58747" relation="include">
        </childnode>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58771">
        <label>ui_interface.h</label>
        <link refid="ui__interface_8h"/>
        <childnode refid="58715" relation="include">
        </childnode>
        <childnode refid="58772" relation="include">
        </childnode>
        <childnode refid="58729" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
      </node>
      <node id="58761">
        <label>leveldbwrapper.h</label>
        <link refid="leveldbwrapper_8h"/>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58683" relation="include">
        </childnode>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58688" relation="include">
        </childnode>
        <childnode refid="58762" relation="include">
        </childnode>
        <childnode refid="58767" relation="include">
        </childnode>
      </node>
      <node id="58701">
        <label>stddef.h</label>
      </node>
      <node id="58705">
        <label>boost/variant.hpp</label>
      </node>
      <node id="58741">
        <label>netdb.h</label>
      </node>
      <node id="58735">
        <label>sys/fcntl.h</label>
      </node>
      <node id="58758">
        <label>undo.h</label>
        <link refid="undo_8h"/>
        <childnode refid="58759" relation="include">
        </childnode>
      </node>
      <node id="58765">
        <label>leveldb/status.h</label>
        <link refid="status_8h"/>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58764" relation="include">
        </childnode>
      </node>
      <node id="58769">
        <label>boost/circular_buffer.hpp</label>
      </node>
      <node id="58656">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58660" relation="include">
        </childnode>
        <childnode refid="58661" relation="include">
        </childnode>
        <childnode refid="58662" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58664" relation="include">
        </childnode>
        <childnode refid="58665" relation="include">
        </childnode>
        <childnode refid="58666" relation="include">
        </childnode>
        <childnode refid="58667" relation="include">
        </childnode>
        <childnode refid="58668" relation="include">
        </childnode>
        <childnode refid="58676" relation="include">
        </childnode>
      </node>
      <node id="58674">
        <label>limits.h</label>
      </node>
      <node id="58679">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
      </node>
      <node id="58752">
        <label>mruset.h</label>
        <link refid="mruset_8h"/>
        <childnode refid="58660" relation="include">
        </childnode>
        <childnode refid="58750" relation="include">
        </childnode>
      </node>
      <node id="58711">
        <label>sys/resource.h</label>
      </node>
      <node id="58721">
        <label>openssl/bio.h</label>
      </node>
      <node id="58754">
        <label>crypter.h</label>
        <link refid="crypter_8h"/>
        <childnode refid="58668" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58690" relation="include">
        </childnode>
      </node>
      <node id="58729">
        <label>boost/signals2/signal.hpp</label>
      </node>
      <node id="58733">
        <label>netbase.h</label>
        <link refid="netbase_8h"/>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58734" relation="include">
        </childnode>
      </node>
      <node id="58690">
        <label>keystore.h</label>
        <link refid="keystore_8h"/>
        <childnode refid="58691" relation="include">
        </childnode>
        <childnode refid="58692" relation="include">
        </childnode>
        <childnode refid="58678" relation="include">
        </childnode>
        <childnode refid="58703" relation="include">
        </childnode>
        <childnode refid="58729" relation="include">
        </childnode>
        <childnode refid="58705" relation="include">
        </childnode>
      </node>
      <node id="58693">
        <label>hash.h</label>
        <link refid="hash_8h"/>
        <childnode refid="58694" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58696" relation="include">
        </childnode>
        <childnode refid="58697" relation="include">
        </childnode>
        <childnode refid="58698" relation="include">
        </childnode>
        <childnode refid="58699" relation="include">
        </childnode>
        <childnode refid="58700" relation="include">
        </childnode>
        <childnode refid="58702" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58740">
        <label>ifaddrs.h</label>
      </node>
      <node id="58726">
        <label>stealth.h</label>
        <link refid="stealth_8h"/>
        <childnode refid="58708" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58670" relation="include">
        </childnode>
        <childnode refid="58727" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58728" relation="include">
        </childnode>
      </node>
      <node id="58709">
        <label>sys/types.h</label>
      </node>
      <node id="58686">
        <label>ios</label>
      </node>
      <node id="58671">
        <label>string.h</label>
      </node>
      <node id="58677">
        <label>clientversion.h</label>
        <link refid="clientversion_8h"/>
      </node>
      <node id="58665">
        <label>cstdio</label>
      </node>
      <node id="58681">
        <label>boost/thread/locks.hpp</label>
      </node>
      <node id="58723">
        <label>openssl/buffer.h</label>
      </node>
      <node id="58666">
        <label>boost/type_traits/is_fundamental.hpp</label>
      </node>
      <node id="58755">
        <label>main.h</label>
        <link refid="main_8h"/>
        <childnode refid="58756" relation="include">
        </childnode>
        <childnode refid="58749" relation="include">
        </childnode>
        <childnode refid="58703" relation="include">
        </childnode>
        <childnode refid="58683" relation="include">
        </childnode>
        <childnode refid="58760" relation="include">
        </childnode>
        <childnode refid="58770" relation="include">
        </childnode>
        <childnode refid="58716" relation="include">
        </childnode>
        <childnode refid="58768" relation="include">
        </childnode>
      </node>
      <node id="58688">
        <label>boost/filesystem/path.hpp</label>
      </node>
      <node id="58768">
        <label>boost/unordered_map.hpp</label>
      </node>
      <node id="58692">
        <label>pubkey.h</label>
        <link refid="pubkey_8h"/>
        <childnode refid="58693" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58694" relation="include">
        </childnode>
        <childnode refid="58695" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58675">
        <label>unistd.h</label>
      </node>
      <node id="58689">
        <label>db_cxx.h</label>
      </node>
      <node id="58658">
        <label>vector</label>
      </node>
      <node id="58706">
        <label>bignum.h</label>
        <link refid="bignum_8h"/>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58694" relation="include">
        </childnode>
        <childnode refid="58707" relation="include">
        </childnode>
        <childnode refid="58695" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
      </node>
      <node id="58749">
        <label>net.h</label>
        <link refid="net_8h"/>
        <childnode refid="58750" relation="include">
        </childnode>
        <childnode refid="58751" relation="include">
        </childnode>
        <childnode refid="58704" relation="include">
        </childnode>
        <childnode refid="58729" relation="include">
        </childnode>
        <childnode refid="58725" relation="include">
        </childnode>
        <childnode refid="58739" relation="include">
        </childnode>
        <childnode refid="58752" relation="include">
        </childnode>
        <childnode refid="58733" relation="include">
        </childnode>
        <childnode refid="58732" relation="include">
        </childnode>
        <childnode refid="58753" relation="include">
        </childnode>
        <childnode refid="58693" relation="include">
        </childnode>
        <childnode refid="58683" relation="include">
        </childnode>
      </node>
      <node id="58697">
        <label>openssl/ripemd.h</label>
      </node>
      <node id="58718">
        <label>boost/filesystem.hpp</label>
      </node>
      <node id="58687">
        <label>utility</label>
      </node>
      <node id="58759">
        <label>compressor.h</label>
        <link refid="compressor_8h"/>
        <childnode refid="58745" relation="include">
        </childnode>
        <childnode refid="58760" relation="include">
        </childnode>
      </node>
      <node id="58714">
        <label>sstream</label>
      </node>
      <node id="58653">
        <label>/home/dev/ds-160209/src/walletdb.cpp</label>
        <link refid="walletdb.cpp"/>
        <childnode refid="58654" relation="include">
        </childnode>
        <childnode refid="58730" relation="include">
        </childnode>
        <childnode refid="58732" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58678" relation="include">
        </childnode>
        <childnode refid="58743" relation="include">
        </childnode>
        <childnode refid="58718" relation="include">
        </childnode>
        <childnode refid="58704" relation="include">
        </childnode>
      </node>
      <node id="58772">
        <label>boost/signals2/last_value.hpp</label>
      </node>
      <node id="58691">
        <label>key.h</label>
        <link refid="key_8h"/>
        <childnode refid="58668" relation="include">
        </childnode>
        <childnode refid="58692" relation="include">
        </childnode>
        <childnode refid="58695" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58722">
        <label>openssl/evp.h</label>
      </node>
      <node id="58712">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="58661" relation="include">
        </childnode>
        <childnode refid="58713" relation="include">
        </childnode>
        <childnode refid="58714" relation="include">
        </childnode>
        <childnode refid="58695" relation="include">
        </childnode>
      </node>
      <node id="58663">
        <label>stdint.h</label>
        <link refid="stdint_8h"/>
      </node>
      <node id="58655">
        <label>db.h</label>
        <link refid="db_8h"/>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58678" relation="include">
        </childnode>
        <childnode refid="58683" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
        <childnode refid="58688" relation="include">
        </childnode>
        <childnode refid="58689" relation="include">
        </childnode>
      </node>
      <node id="58702">
        <label>crypto/argon2/argon2.h</label>
        <link refid="argon2_8h"/>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58701" relation="include">
        </childnode>
        <childnode refid="58674" relation="include">
        </childnode>
      </node>
      <node id="58683">
        <label>streams.h</label>
        <link refid="streams_8h"/>
        <childnode refid="58668" relation="include">
        </childnode>
        <childnode refid="58656" relation="include">
        </childnode>
        <childnode refid="58684" relation="include">
        </childnode>
        <childnode refid="58685" relation="include">
        </childnode>
        <childnode refid="58686" relation="include">
        </childnode>
        <childnode refid="58662" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58660" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58671" relation="include">
        </childnode>
        <childnode refid="58687" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58710">
        <label>sys/time.h</label>
      </node>
      <node id="58713">
        <label>iostream</label>
      </node>
      <node id="58750">
        <label>deque</label>
      </node>
      <node id="58694">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="58685" relation="include">
        </childnode>
        <childnode refid="58664" relation="include">
        </childnode>
        <childnode refid="58695" relation="include">
        </childnode>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58736">
        <label>sys/socket.h</label>
      </node>
      <node id="58764">
        <label>leveldb/slice.h</label>
        <link refid="slice_8h"/>
        <childnode refid="58685" relation="include">
        </childnode>
        <childnode refid="58701" relation="include">
        </childnode>
        <childnode refid="58671" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
      </node>
      <node id="58751">
        <label>boost/array.hpp</label>
      </node>
      <node id="58707">
        <label>openssl/bn.h</label>
      </node>
      <node id="58760">
        <label>txdb.h</label>
        <link refid="txdb_8h"/>
        <childnode refid="58761" relation="include">
        </childnode>
        <childnode refid="58755" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58687" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58747">
        <label>timedata.h</label>
        <link refid="timedata_8h"/>
        <childnode refid="58663" relation="include">
        </childnode>
      </node>
      <node id="58668">
        <label>allocators.h</label>
        <link refid="allocators_8h"/>
        <childnode refid="58669" relation="include">
        </childnode>
        <childnode refid="58671" relation="include">
        </childnode>
        <childnode refid="58657" relation="include">
        </childnode>
        <childnode refid="58672" relation="include">
        </childnode>
        <childnode refid="58659" relation="include">
        </childnode>
        <childnode refid="58673" relation="include">
        </childnode>
        <childnode refid="58674" relation="include">
        </childnode>
        <childnode refid="58675" relation="include">
        </childnode>
      </node>
      <node id="58731">
        <label>chainparams.h</label>
        <link refid="chainparams_8h"/>
        <childnode refid="58706" relation="include">
        </childnode>
        <childnode refid="58694" relation="include">
        </childnode>
        <childnode refid="58658" relation="include">
        </childnode>
      </node>
      <node id="58660">
        <label>set</label>
      </node>
      <node id="58684">
        <label>algorithm</label>
      </node>
      <node id="58698">
        <label>crypto/ripemd160.h</label>
        <link refid="ripemd160_8h"/>
        <childnode refid="58663" relation="include">
        </childnode>
        <childnode refid="58670" relation="include">
        </childnode>
      </node>
      <node id="58746">
        <label>util.h</label>
      </node>
      <node id="58727">
        <label>stdio.h</label>
      </node>
      <node id="58669">
        <label>cleanse.h</label>
        <link refid="cleanse_8h"/>
        <childnode refid="58670" relation="include">
        </childnode>
      </node>
      <node id="58664">
        <label>cstring</label>
      </node>
      <node id="58678">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="58679" relation="include">
        </childnode>
        <childnode refid="58680" relation="include">
        </childnode>
        <childnode refid="58681" relation="include">
        </childnode>
        <childnode refid="58672" relation="include">
        </childnode>
        <childnode refid="58682" relation="include">
        </childnode>
      </node>
      <node id="58728">
        <label>inttypes.h</label>
      </node>
      <node id="58763">
        <label>leveldb/iterator.h</label>
        <link refid="iterator_8h"/>
        <childnode refid="58764" relation="include">
        </childnode>
        <childnode refid="58765" relation="include">
        </childnode>
      </node>
      <node id="58744">
        <label>primitives/block.h</label>
        <link refid="primitives_2block_8h"/>
        <childnode refid="58745" relation="include">
        </childnode>
        <childnode refid="58702" relation="include">
        </childnode>
        <childnode refid="58748" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <innerclass refid="class_c_wallet_scan_state" prot="public">CWalletScanState</innerclass>
      <sectiondef kind="var">
      <memberdef kind="variable" id="walletdb_8cpp_1ab3d0dabe6a840404c36cec31b5566634" prot="public" static="yes" mutable="no">
        <type><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref></type>
        <definition>uint64_t nAccountingEntryNumber</definition>
        <argsstring></argsstring>
        <name>nAccountingEntryNumber</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/dev/ds-160209/src/walletdb.cpp" line="22" column="1" bodyfile="/home/dev/ds-160209/src/walletdb.cpp" bodystart="22" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="walletdb_8cpp_1a0bc784e958b92854437f2238d4249da0" prot="public" static="no" mutable="no">
        <type>bool</type>
        <definition>bool fWalletUnlockStakingOnly</definition>
        <argsstring></argsstring>
        <name>fWalletUnlockStakingOnly</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/dev/ds-160209/src/walletdb.cpp" line="23" column="1" bodyfile="/home/dev/ds-160209/src/wallet.cpp" bodystart="166" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="walletdb_8cpp_1ad1f171cf096f5479805a06fc20480343" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool ReadKeyValue</definition>
        <argsstring>(CWallet *pwallet, CDataStream &amp;ssKey, CDataStream &amp;ssValue, CWalletScanState &amp;wss, string &amp;strType, string &amp;strErr)</argsstring>
        <name>ReadKeyValue</name>
        <param>
          <type><ref refid="class_c_wallet" kindref="compound">CWallet</ref> *</type>
          <declname>pwallet</declname>
        </param>
        <param>
          <type><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref> &amp;</type>
          <declname>ssKey</declname>
        </param>
        <param>
          <type><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref> &amp;</type>
          <declname>ssValue</declname>
        </param>
        <param>
          <type><ref refid="class_c_wallet_scan_state" kindref="compound">CWalletScanState</ref> &amp;</type>
          <declname>wss</declname>
        </param>
        <param>
          <type>string &amp;</type>
          <declname>strType</declname>
        </param>
        <param>
          <type>string &amp;</type>
          <declname>strErr</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/dev/ds-160209/src/walletdb.cpp" line="357" column="1" bodyfile="/home/dev/ds-160209/src/walletdb.cpp" bodystart="357" bodyend="622"/>
        <references refid="class_c_wallet_1afed31f2489c987e0f76233121ed84ab7" compoundref="wallet_8h" startline="196">CWallet::mapAddressBook</references>
        <references refid="class_c_dark_silk_address_1a907e63758c7914a246b5807f6babf97d" compoundref="base58_8cpp" startline="225" endline="236">CDarkSilkAddress::Get</references>
        <references refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" compoundref="cache_8cc" startline="34">hash</references>
        <references refid="class_c_wallet_1a0b17f72f2170090f2de43a6c48af3214" compoundref="wallet_8h" startline="192">CWallet::mapWallet</references>
        <references refid="db__test_8cc_1a42432b4356adce5579ccf597f6e83e54" compoundref="db__test_8cc" startline="1744">state</references>
        <references refid="class_c_validation_state_1af4c51946b39b2234b8004d58fbc164a5" compoundref="main_8h" startline="535" endline="537">CValidationState::IsValid</references>
        <references refid="class_c_data_stream_1a6e50e788d33080ac804e4d8ba7150279" compoundref="streams_8h" startline="117" endline="117">CDataStream::empty</references>
        <references refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" compoundref="tinyformat_8h" startline="1011">strprintf</references>
        <references refid="class_c_wallet_scan_state_1a6cbf626ca5a0275f0469684f22dff12f" compoundref="walletdb_8cpp" startline="347">CWalletScanState::vWalletUpgrade</references>
        <references refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" compoundref="walletdb_8cpp" startline="345">CWalletScanState::fAnyUnordered</references>
        <references refid="class_c_wallet_1adf34c789fd6eab1eeed22ef16837f558" compoundref="wallet_8cpp" startline="644" endline="761">CWallet::AddToWallet</references>
        <references refid="util_8cpp_1a2ba7badc843121dde40a6f109d224a42" compoundref="util_8cpp" startline="96">fDebug</references>
        <references refid="class_c_wallet_1a148a31a8069304a6593b3c5266417b10" compoundref="wallet_8h" startline="154">CWallet::stealthAddresses</references>
        <references refid="class_c_wallet_1ad6580f1844fc639389e1c6a1e2787ee6" compoundref="wallet_8cpp" startline="209" endline="212">CWallet::LoadWatchOnly</references>
        <references refid="class_c_wallet_1a817c0d1034377a7bd70a714140a5a8ca" compoundref="wallet_8h" startline="202">CWallet::nTimeFirstKey</references>
        <references refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" compoundref="walletdb_8cpp" startline="341">CWalletScanState::nKeys</references>
        <references refid="class_c_wallet_key_1a28f9bbffcc9d7f2f784d5e4be8ca31f7" compoundref="wallet_8h" startline="1114">CWalletKey::vchPrivKey</references>
        <references refid="hash_8h_1ab3f6c437460137530d86e09c2c102e99" compoundref="hash_8h" startline="77" endline="85">Hash</references>
        <references refid="class_c_key_1a141751588f8bfe5f1b6fc27f4e64b63f" compoundref="key_8cpp" startline="226" endline="236">CKey::Load</references>
        <references refid="class_c_wallet_1a439bab81d7989f91a4f0909960516eea" compoundref="wallet_8h" startline="227" endline="227">CWallet::LoadKey</references>
        <references refid="class_c_wallet_1a23c5badf56c297a95557af3073d4aa32" compoundref="wallet_8h" startline="162">CWallet::mapMasterKeys</references>
        <references refid="class_c_wallet_1aecfc6e4a6ea958ec369ca77d790271e3" compoundref="wallet_8h" startline="163">CWallet::nMasterKeyMaxID</references>
        <references refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" compoundref="walletdb_8cpp" startline="342">CWalletScanState::nCKeys</references>
        <references refid="class_c_wallet_1a01fbd78238d4ef833d059f12a7e8ac9f" compoundref="wallet_8cpp" startline="149" endline="152">CWallet::LoadCryptedKey</references>
        <references refid="class_c_wallet_scan_state_1a13c5139c5966079d1be4c739666c5243" compoundref="walletdb_8cpp" startline="344">CWalletScanState::fIsEncrypted</references>
        <references refid="class_c_wallet_scan_state_1a2cfbc8894839188b57be22e72f2d6de4" compoundref="walletdb_8cpp" startline="343">CWalletScanState::nKeyMeta</references>
        <references refid="class_c_wallet_1a21e6580474514f838dfe1446890085a4" compoundref="wallet_8cpp" startline="139" endline="147">CWallet::LoadKeyMetadata</references>
        <references refid="class_c_wallet_1aeb612f84011f0b02c070c2d39594b9fb" compoundref="wallet_8h" startline="155">CWallet::mapStealthKeyMeta</references>
        <references refid="class_c_wallet_1a6d415899e530a91e6e28dd0fa4ecef8d" compoundref="wallet_8h" startline="198">CWallet::vchDefaultKey</references>
        <references refid="class_c_wallet_1a363fabb2b82d596c33e4fa3920a11c26" compoundref="wallet_8h" startline="151">CWallet::setKeyPool</references>
        <references refid="class_c_wallet_1acfd09bc5a2daee930f9f988efac8dbb7" compoundref="wallet_8h" startline="152">CWallet::mapKeyMetadata</references>
        <references refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" compoundref="walletdb_8cpp" startline="346">CWalletScanState::nFileVersion</references>
        <references refid="class_c_wallet_1adbf0abef9da8102f000d4afd5cec5bbc" compoundref="wallet_8cpp" startline="168" endline="182">CWallet::LoadCScript</references>
        <references refid="class_c_wallet_1af56cb17b19742506fc8d9449fc60884e" compoundref="wallet_8h" startline="193">CWallet::nOrderPosNext</references>
        <referencedby refid="class_c_wallet_d_b_1a14f26e53502d1a60dd2b034f830acf03" compoundref="walletdb_8cpp" startline="630" endline="730">CWalletDB::LoadWallet</referencedby>
        <referencedby refid="class_c_wallet_d_b_1a3ebeb12f37d9c66512e2bc2903a6854a" compoundref="walletdb_8cpp" startline="837" endline="913">CWalletDB::Recover</referencedby>
      </memberdef>
      <memberdef kind="function" id="walletdb_8cpp_1a46e85dcfea881e75391f118eefd4cacc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool IsKeyType</definition>
        <argsstring>(string strType)</argsstring>
        <name>IsKeyType</name>
        <param>
          <type>string</type>
          <declname>strType</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/dev/ds-160209/src/walletdb.cpp" line="624" column="1" bodyfile="/home/dev/ds-160209/src/walletdb.cpp" bodystart="624" bodyend="628"/>
      </memberdef>
      <memberdef kind="function" id="walletdb_8cpp_1a571e13707ba159c7c047875764ae5e2b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ThreadFlushWalletDB</definition>
        <argsstring>(const string &amp;strFile)</argsstring>
        <name>ThreadFlushWalletDB</name>
        <param>
          <type>const string &amp;</type>
          <declname>strFile</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/dev/ds-160209/src/walletdb.cpp" line="732" column="1" bodyfile="/home/dev/ds-160209/src/walletdb.cpp" bodystart="732" bodyend="792"/>
        <references refid="util_8cpp_1a85fc1244e0bd3c91ee7a1c05ed10ebbb" compoundref="util_8cpp" startline="1441" endline="1463">RenameThread</references>
        <references refid="util_8cpp_1a64d956f1dda7f9a80ab5d594532b906d" compoundref="util_8cpp" startline="550" endline="559">GetBoolArg</references>
        <references refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" compoundref="db_8cpp" startline="24">nWalletDBUpdated</references>
        <references refid="util_8cpp_1a46fac5fba8ba905b5f9acb364f5d8c6f" compoundref="util_8cpp" startline="1352" endline="1357">GetTime</references>
        <references refid="util_8h_1ac635182d3e845eda4af4fa5ab31609da" compoundref="util_8h" startline="107" endline="114">MilliSleep</references>
        <references refid="sync_8h_1aca08e7299069c2d60b8aa726fc550612" compoundref="sync_8h" startline="161">TRY_LOCK</references>
        <references refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" compoundref="db_8cpp" startline="32">bitdb</references>
        <references refid="class_c_d_b_env_1af71bf28f9142c38aedc550353270b2b7" compoundref="db_8h" startline="45">CDBEnv::cs_db</references>
        <references refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" compoundref="db_8h" startline="47">CDBEnv::mapFileUseCount</references>
        <references refid="util_8h_1a139d0fe6387b9e230a9b8bb12d9b43b9" compoundref="util_8h" startline="383" endline="387">GetTimeMillis</references>
        <references refid="class_c_d_b_env_1ac53fd53afdd1e0881b8ffbb11a89b556" compoundref="db_8cpp" startline="319" endline="332">CDBEnv::CloseDb</references>
        <references refid="class_c_d_b_env_1aa4e0fe52dfc0da22fe9bf59eeda57fba" compoundref="db_8cpp" startline="222" endline="228">CDBEnv::CheckpointLSN</references>
      </memberdef>
      <memberdef kind="function" id="walletdb_8cpp_1a273c3692765c732c5f724cec93e6b62f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool BackupWallet</definition>
        <argsstring>(const CWallet &amp;wallet, const string &amp;strDest)</argsstring>
        <name>BackupWallet</name>
        <param>
          <type>const <ref refid="class_c_wallet" kindref="compound">CWallet</ref> &amp;</type>
          <declname>wallet</declname>
        </param>
        <param>
          <type>const string &amp;</type>
          <declname>strDest</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/dev/ds-160209/src/walletdb.cpp" line="794" column="1" bodyfile="/home/dev/ds-160209/src/walletdb.cpp" bodystart="794" bodyend="832"/>
        <references refid="class_c_wallet_1a1b2e285b4d7bd105c792941aa666249c" compoundref="wallet_8h" startline="147">CWallet::fFileBacked</references>
        <references refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" compoundref="sync_8h" startline="159">LOCK</references>
        <references refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" compoundref="db_8cpp" startline="32">bitdb</references>
        <references refid="class_c_d_b_env_1af71bf28f9142c38aedc550353270b2b7" compoundref="db_8h" startline="45">CDBEnv::cs_db</references>
        <references refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" compoundref="db_8h" startline="47">CDBEnv::mapFileUseCount</references>
        <references refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" compoundref="wallet_8h" startline="149">CWallet::strWalletFile</references>
        <references refid="class_c_d_b_env_1ac53fd53afdd1e0881b8ffbb11a89b556" compoundref="db_8cpp" startline="319" endline="332">CDBEnv::CloseDb</references>
        <references refid="class_c_d_b_env_1aa4e0fe52dfc0da22fe9bf59eeda57fba" compoundref="db_8cpp" startline="222" endline="228">CDBEnv::CheckpointLSN</references>
        <references refid="util_8cpp_1ab83866a054745d4b30a3948a1b44beba" compoundref="util_8cpp" startline="1109" endline="1140">GetDataDir</references>
        <references refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" compoundref="util_8h" startline="158">LogPrintf</references>
        <references refid="util_8h_1ac635182d3e845eda4af4fa5ab31609da" compoundref="util_8h" startline="107" endline="114">MilliSleep</references>
        <referencedby refid="class_wallet_model_1aa316c19ef41f26ea89f194ab253d3206" compoundref="walletmodel_8cpp" startline="573" endline="576">WalletModel::backupWallet</referencedby>
        <referencedby refid="rpcwallet_8cpp_1a7813bcc93d80c6c4ad0ae846f80cff3e" compoundref="rpcwallet_8cpp" startline="1909" endline="1927">backupwallet</referencedby>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2009-2016<sp/>Satoshi<sp/>Nakamoto</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2009-2016<sp/>The<sp/>Bitcoin<sp/>Developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2015-2016<sp/>Silk<sp/>Network</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT/X11<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="walletdb_8h" kindref="compound">walletdb.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="base58_8h" kindref="compound">base58.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="protocol_8h" kindref="compound">protocol.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="serialize_8h" kindref="compound">serialize.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="sync_8h" kindref="compound">sync.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="wallet_8h" kindref="compound">wallet.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;boost/filesystem.hpp&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;boost/foreach.hpp&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespacestd" kindref="compound">std</ref>;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceboost" kindref="compound">boost</ref>;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref><sp/>nAccountingEntryNumber<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="walletdb_8cpp_1a0bc784e958b92854437f2238d4249da0" kindref="member">fWalletUnlockStakingOnly</ref>;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="comment">//<sp/>CWalletDB</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29" refid="class_c_wallet_d_b_1ad1b3bce77e9dd6ddd8c668a469c38f0a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1ad1b3bce77e9dd6ddd8c668a469c38f0a" kindref="member">CWalletDB::WriteName</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strAddress,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strName)</highlight></codeline>
<codeline lineno="30"><highlight class="normal">{</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(make_pair(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">),<sp/>strAddress),<sp/>strName);</highlight></codeline>
<codeline lineno="33"><highlight class="normal">}</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35" refid="class_c_wallet_d_b_1a319209fcf90ea860b668b92c44a3fa7a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a319209fcf90ea860b668b92c44a3fa7a" kindref="member">CWalletDB::EraseName</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strAddress)</highlight></codeline>
<codeline lineno="36"><highlight class="normal">{</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>should<sp/>only<sp/>be<sp/>used<sp/>for<sp/>sending<sp/>addresses,<sp/>never<sp/>for<sp/>receiving<sp/>addresses,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>receiving<sp/>addresses<sp/>must<sp/>always<sp/>have<sp/>an<sp/>address<sp/>book<sp/>entry<sp/>if<sp/>they&apos;re<sp/>not<sp/>change<sp/>return.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Erase(make_pair(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">),<sp/>strAddress));</highlight></codeline>
<codeline lineno="41"><highlight class="normal">}</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43" refid="class_c_wallet_d_b_1a76d2ca02898221ab66df5d5f7491164e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a76d2ca02898221ab66df5d5f7491164e" kindref="member">CWalletDB::WriteTx</ref>(<ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_tx" kindref="compound">CWalletTx</ref>&amp;<sp/>wtx)</highlight></codeline>
<codeline lineno="44"><highlight class="normal">{</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;tx&quot;</highlight><highlight class="normal">),<sp/>hash),<sp/>wtx);</highlight></codeline>
<codeline lineno="47"><highlight class="normal">}</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49" refid="class_c_wallet_d_b_1a498e00c693cacc4b558e6f5295ea32f2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a498e00c693cacc4b558e6f5295ea32f2" kindref="member">CWalletDB::EraseTx</ref>(<ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>)</highlight></codeline>
<codeline lineno="50"><highlight class="normal">{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Erase(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;tx&quot;</highlight><highlight class="normal">),<sp/>hash));</highlight></codeline>
<codeline lineno="53"><highlight class="normal">}</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55" refid="class_c_wallet_d_b_1a68428260802d8acd1a6f87f92b991841" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a68428260802d8acd1a6f87f92b991841" kindref="member">CWalletDB::WriteStealthKeyMeta</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_key_i_d" kindref="compound">CKeyID</ref>&amp;<sp/>keyId,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_stealth_key_metadata" kindref="compound">CStealthKeyMetadata</ref>&amp;<sp/>sxKeyMeta)</highlight></codeline>
<codeline lineno="56"><highlight class="normal">{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;sxKeyMeta&quot;</highlight><highlight class="normal">),<sp/>keyId),<sp/>sxKeyMeta,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="59"><highlight class="normal">}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="class_c_wallet_d_b_1a401ec8ec6c7e38cf87be9b92f95052a4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a401ec8ec6c7e38cf87be9b92f95052a4" kindref="member">CWalletDB::EraseStealthKeyMeta</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_key_i_d" kindref="compound">CKeyID</ref>&amp;<sp/>keyId)</highlight></codeline>
<codeline lineno="62"><highlight class="normal">{</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Erase(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;sxKeyMeta&quot;</highlight><highlight class="normal">),<sp/>keyId));</highlight></codeline>
<codeline lineno="65"><highlight class="normal">}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67" refid="class_c_wallet_d_b_1a2bce6f7f050d6d14e2c025a7beba2cfc" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a2bce6f7f050d6d14e2c025a7beba2cfc" kindref="member">CWalletDB::WriteStealthAddress</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_stealth_address" kindref="compound">CStealthAddress</ref>&amp;<sp/>sxAddr)</highlight></codeline>
<codeline lineno="68"><highlight class="normal">{</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;sxAddr&quot;</highlight><highlight class="normal">),<sp/>sxAddr.<ref refid="class_c_stealth_address_1ae695d1d4c649d3f78b253de7d273b1d9" kindref="member">scan_pubkey</ref>),<sp/>sxAddr,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="72"><highlight class="normal">}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74" refid="class_c_wallet_d_b_1aebcc02069f91916c652d4e3e13be0f0b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1aebcc02069f91916c652d4e3e13be0f0b" kindref="member">CWalletDB::ReadStealthAddress</ref>(<ref refid="class_c_stealth_address" kindref="compound">CStealthAddress</ref>&amp;<sp/>sxAddr)</highlight></codeline>
<codeline lineno="75"><highlight class="normal">{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>--<sp/>set<sp/>scan_pubkey<sp/>before<sp/>reading</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Read(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;sxAddr&quot;</highlight><highlight class="normal">),<sp/>sxAddr.<ref refid="class_c_stealth_address_1ae695d1d4c649d3f78b253de7d273b1d9" kindref="member">scan_pubkey</ref>),<sp/>sxAddr);</highlight></codeline>
<codeline lineno="78"><highlight class="normal">}</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80" refid="class_c_wallet_d_b_1a7ebef5e0c7f604aa2159ba96d527e3a2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a7ebef5e0c7f604aa2159ba96d527e3a2" kindref="member">CWalletDB::WriteKey</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>vchPubKey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="key_8h_1a1da569b8b6e5b3fa1196cc1b877e7f54" kindref="member">CPrivKey</ref>&amp;<sp/>vchPrivKey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_key_metadata" kindref="compound">CKeyMetadata</ref>&amp;<sp/>keyMeta)</highlight></codeline>
<codeline lineno="81"><highlight class="normal">{</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;keymeta&quot;</highlight><highlight class="normal">),<sp/>vchPubKey),</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keyMeta,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>hash<sp/>pubkey/privkey<sp/>to<sp/>accelerate<sp/>wallet<sp/>load</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchKey;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>vchKey.reserve(vchPubKey.<ref refid="class_c_pub_key_1a9d7129b65b6dee792b4f3923cd64ed59" kindref="member">size</ref>()<sp/>+<sp/>vchPrivKey.size());</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>vchKey.insert(vchKey.end(),<sp/>vchPubKey.<ref refid="class_c_pub_key_1add9987e0d25aff11181f5ad70413994b" kindref="member">begin</ref>(),<sp/>vchPubKey.<ref refid="class_c_pub_key_1aa559d2a4f2cbdec84c02a4adc18fa657" kindref="member">end</ref>());</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>vchKey.insert(vchKey.end(),<sp/>vchPrivKey.begin(),<sp/>vchPrivKey.end());</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;key&quot;</highlight><highlight class="normal">),<sp/>vchPubKey),<sp/>std::make_pair(vchPrivKey,<sp/><ref refid="hash_8h_1ab3f6c437460137530d86e09c2c102e99" kindref="member">Hash</ref>(vchKey.begin(),<sp/>vchKey.end())),<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="95"><highlight class="normal">}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97" refid="class_c_wallet_d_b_1a914fb53d1731daf9b486f164dd325210" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a914fb53d1731daf9b486f164dd325210" kindref="member">CWalletDB::WriteCryptedKey</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>vchPubKey,</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>vchCryptedSecret,</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_key_metadata" kindref="compound">CKeyMetadata</ref><sp/>&amp;keyMeta)</highlight></codeline>
<codeline lineno="100"><highlight class="normal">{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fEraseUnencryptedKey<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;keymeta&quot;</highlight><highlight class="normal">),<sp/>vchPubKey),</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keyMeta))</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;ckey&quot;</highlight><highlight class="normal">),<sp/>vchPubKey),<sp/>vchCryptedSecret,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fEraseUnencryptedKey)</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Erase(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;key&quot;</highlight><highlight class="normal">),<sp/>vchPubKey));</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Erase(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;wkey&quot;</highlight><highlight class="normal">),<sp/>vchPubKey));</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="116"><highlight class="normal">}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118" refid="class_c_wallet_d_b_1a507690da431ef61244941ad39c308aeb" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a507690da431ef61244941ad39c308aeb" kindref="member">CWalletDB::WriteMasterKey</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nID,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_master_key" kindref="compound">CMasterKey</ref>&amp;<sp/>kMasterKey)</highlight></codeline>
<codeline lineno="119"><highlight class="normal">{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;mkey&quot;</highlight><highlight class="normal">),<sp/>nID),<sp/>kMasterKey,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="122"><highlight class="normal">}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124" refid="class_c_wallet_d_b_1a8c69e48e2305775898658e0a4f4616c9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a8c69e48e2305775898658e0a4f4616c9" kindref="member">CWalletDB::WriteCScript</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint160" kindref="compound">uint160</ref>&amp;<sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref>&amp;<sp/>redeemScript)</highlight></codeline>
<codeline lineno="125"><highlight class="normal">{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;cscript&quot;</highlight><highlight class="normal">),<sp/>hash),<sp/>redeemScript,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="128"><highlight class="normal">}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130" refid="class_c_wallet_d_b_1a05e5a277f66010d12071a5d72cb4dfb0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a05e5a277f66010d12071a5d72cb4dfb0" kindref="member">CWalletDB::WriteWatchOnly</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>&amp;dest)</highlight></codeline>
<codeline lineno="131"><highlight class="normal">{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;watchonly&quot;</highlight><highlight class="normal">),<sp/>dest),<sp/></highlight><highlight class="charliteral">&apos;1&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="134"><highlight class="normal">}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136" refid="class_c_wallet_d_b_1ad6e63f550853905fcd67ec9e7c3bef8b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1ad6e63f550853905fcd67ec9e7c3bef8b" kindref="member">CWalletDB::EraseWatchOnly</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>&amp;dest)</highlight></codeline>
<codeline lineno="137"><highlight class="normal">{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Erase(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;watchonly&quot;</highlight><highlight class="normal">),<sp/>dest));</highlight></codeline>
<codeline lineno="140"><highlight class="normal">}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142" refid="class_c_wallet_d_b_1a5660d366fee16ab81f3e7d3a97892486" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a5660d366fee16ab81f3e7d3a97892486" kindref="member">CWalletDB::WriteBestBlock</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_locator" kindref="compound">CBlockLocator</ref>&amp;<sp/>locator)</highlight></codeline>
<codeline lineno="143"><highlight class="normal">{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::string(</highlight><highlight class="stringliteral">&quot;bestblock&quot;</highlight><highlight class="normal">),<sp/>locator);</highlight></codeline>
<codeline lineno="146"><highlight class="normal">}</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148" refid="class_c_wallet_d_b_1a20eecdac6605607ff7cba2f55ec86f73" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a20eecdac6605607ff7cba2f55ec86f73" kindref="member">CWalletDB::ReadBestBlock</ref>(<ref refid="class_c_block_locator" kindref="compound">CBlockLocator</ref>&amp;<sp/>locator)</highlight></codeline>
<codeline lineno="149"><highlight class="normal">{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Read(std::string(</highlight><highlight class="stringliteral">&quot;bestblock&quot;</highlight><highlight class="normal">),<sp/>locator);</highlight></codeline>
<codeline lineno="151"><highlight class="normal">}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153" refid="class_c_wallet_d_b_1a6a1f671e6376b38a1f73c8a023abdd38" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a6a1f671e6376b38a1f73c8a023abdd38" kindref="member">CWalletDB::WriteOrderPosNext</ref>(<ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nOrderPosNext)</highlight></codeline>
<codeline lineno="154"><highlight class="normal">{</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::string(</highlight><highlight class="stringliteral">&quot;orderposnext&quot;</highlight><highlight class="normal">),<sp/>nOrderPosNext);</highlight></codeline>
<codeline lineno="157"><highlight class="normal">}</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159" refid="class_c_wallet_d_b_1a1d925af18104900bddd19c968a0402b5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a1d925af18104900bddd19c968a0402b5" kindref="member">CWalletDB::WriteDefaultKey</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>vchPubKey)</highlight></codeline>
<codeline lineno="160"><highlight class="normal">{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::string(</highlight><highlight class="stringliteral">&quot;defaultkey&quot;</highlight><highlight class="normal">),<sp/>vchPubKey);</highlight></codeline>
<codeline lineno="163"><highlight class="normal">}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165" refid="class_c_wallet_d_b_1a6a03927cf247314ccd9b285139de0bd1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a6a03927cf247314ccd9b285139de0bd1" kindref="member">CWalletDB::ReadPool</ref>(<ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nPool,<sp/><ref refid="class_c_key_pool" kindref="compound">CKeyPool</ref>&amp;<sp/>keypool)</highlight></codeline>
<codeline lineno="166"><highlight class="normal">{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Read(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;pool&quot;</highlight><highlight class="normal">),<sp/>nPool),<sp/>keypool);</highlight></codeline>
<codeline lineno="168"><highlight class="normal">}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170" refid="class_c_wallet_d_b_1ad43630ad28a68c3e8b1a633f09aa0964" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1ad43630ad28a68c3e8b1a633f09aa0964" kindref="member">CWalletDB::WritePool</ref>(<ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nPool,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_key_pool" kindref="compound">CKeyPool</ref>&amp;<sp/>keypool)</highlight></codeline>
<codeline lineno="171"><highlight class="normal">{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;pool&quot;</highlight><highlight class="normal">),<sp/>nPool),<sp/>keypool);</highlight></codeline>
<codeline lineno="174"><highlight class="normal">}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176" refid="class_c_wallet_d_b_1ac78d839fbda5164c4134ab67911139ca" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1ac78d839fbda5164c4134ab67911139ca" kindref="member">CWalletDB::ErasePool</ref>(<ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nPool)</highlight></codeline>
<codeline lineno="177"><highlight class="normal">{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>++;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Erase(std::make_pair(std::string(</highlight><highlight class="stringliteral">&quot;pool&quot;</highlight><highlight class="normal">),<sp/>nPool));</highlight></codeline>
<codeline lineno="180"><highlight class="normal">}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182" refid="class_c_wallet_d_b_1ab008b6c6e09a60a988cac6e1a9e11886" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1ab008b6c6e09a60a988cac6e1a9e11886" kindref="member">CWalletDB::WriteMinVersion</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nVersion)</highlight></codeline>
<codeline lineno="183"><highlight class="normal">{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(std::string(</highlight><highlight class="stringliteral">&quot;minversion&quot;</highlight><highlight class="normal">),<sp/>nVersion);</highlight></codeline>
<codeline lineno="185"><highlight class="normal">}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187" refid="class_c_wallet_d_b_1afa8d9d374072629b360adb49b9bdd584" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1afa8d9d374072629b360adb49b9bdd584" kindref="member">CWalletDB::ReadAccount</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strAccount,<sp/><ref refid="class_c_account" kindref="compound">CAccount</ref>&amp;<sp/>account)</highlight></codeline>
<codeline lineno="188"><highlight class="normal">{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>account.<ref refid="class_c_account_1ac63a4127fd899a21a5916a86588e809a" kindref="member">SetNull</ref>();</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Read(make_pair(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;acc&quot;</highlight><highlight class="normal">),<sp/>strAccount),<sp/>account);</highlight></codeline>
<codeline lineno="191"><highlight class="normal">}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193" refid="class_c_wallet_d_b_1afef640a4990f74fd5af7178c99415cf3" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1afef640a4990f74fd5af7178c99415cf3" kindref="member">CWalletDB::WriteAccount</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strAccount,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_account" kindref="compound">CAccount</ref>&amp;<sp/>account)</highlight></codeline>
<codeline lineno="194"><highlight class="normal">{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(make_pair(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;acc&quot;</highlight><highlight class="normal">),<sp/>strAccount),<sp/>account);</highlight></codeline>
<codeline lineno="196"><highlight class="normal">}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CWalletDB::WriteAccountingEntry(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref><sp/>nAccEntryNum,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref>&amp;<sp/>acentry)</highlight></codeline>
<codeline lineno="199"><highlight class="normal">{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Write(boost::make_tuple(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;acentry&quot;</highlight><highlight class="normal">),<sp/>acentry.<ref refid="class_c_accounting_entry_1a01434c1b0edad576bc1584c9b667ce1d" kindref="member">strAccount</ref>,<sp/>nAccEntryNum),<sp/>acentry);</highlight></codeline>
<codeline lineno="201"><highlight class="normal">}</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203" refid="class_c_wallet_d_b_1a958a0138b171e213be35f48933adcb89" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CWalletDB::WriteAccountingEntry(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref>&amp;<sp/>acentry)</highlight></codeline>
<codeline lineno="204"><highlight class="normal">{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>WriteAccountingEntry(++nAccountingEntryNumber,<sp/>acentry);</highlight></codeline>
<codeline lineno="206"><highlight class="normal">}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="class_c_wallet_d_b_1af924f6275a873e048699e6ef0bf66346" refkind="member"><highlight class="normal"><ref refid="amount_8h_1a4eaf3a5239714d8c45b851527f7cb564" kindref="member">CAmount</ref><sp/><ref refid="class_c_wallet_d_b_1af924f6275a873e048699e6ef0bf66346" kindref="member">CWalletDB::GetAccountCreditDebit</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strAccount)</highlight></codeline>
<codeline lineno="209"><highlight class="normal">{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>list&lt;CAccountingEntry&gt;<sp/>entries;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>ListAccountCreditDebit(strAccount,<sp/>entries);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="amount_8h_1a4eaf3a5239714d8c45b851527f7cb564" kindref="member">CAmount</ref><sp/>nCreditDebit<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>BOOST_FOREACH<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref>&amp;<sp/>entry,<sp/>entries)</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nCreditDebit<sp/>+=<sp/>entry.<ref refid="class_c_accounting_entry_1a3a0377685a688c97af2e40581e919b0f" kindref="member">nCreditDebit</ref>;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>nCreditDebit;</highlight></codeline>
<codeline lineno="218"><highlight class="normal">}</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220" refid="class_c_wallet_d_b_1a51555c82291fe16081880110541e207f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a51555c82291fe16081880110541e207f" kindref="member">CWalletDB::ListAccountCreditDebit</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strAccount,<sp/>list&lt;CAccountingEntry&gt;&amp;<sp/>entries)</highlight></codeline>
<codeline lineno="221"><highlight class="normal">{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fAllAccounts<sp/>=<sp/>(strAccount<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;*&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/>Dbc*<sp/>pcursor<sp/>=<sp/>GetCursor();</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pcursor)</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>runtime_error(</highlight><highlight class="stringliteral">&quot;CWalletDB::ListAccountCreditDebit()<sp/>:<sp/>cannot<sp/>create<sp/>DB<sp/>cursor&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fFlags<sp/>=<sp/>DB_SET_RANGE;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">true</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Read<sp/>next<sp/>record</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref><sp/>ssKey(<ref refid="serialize_8h_1a6b7b47dd702d9e331586d485013fd1eaa34949680c53028d35a449bf88b3c329d" kindref="member">SER_DISK</ref>,<sp/>CLIENT_VERSION);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fFlags<sp/>==<sp/>DB_SET_RANGE)</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&lt;&lt;<sp/>boost::make_tuple(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;acentry&quot;</highlight><highlight class="normal">),<sp/>(fAllAccounts?<sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)<sp/>:<sp/>strAccount),<sp/><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref>(0));</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref><sp/>ssValue(<ref refid="serialize_8h_1a6b7b47dd702d9e331586d485013fd1eaa34949680c53028d35a449bf88b3c329d" kindref="member">SER_DISK</ref>,<sp/>CLIENT_VERSION);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>ReadAtCursor(pcursor,<sp/>ssKey,<sp/>ssValue,<sp/>fFlags);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fFlags<sp/>=<sp/>DB_NEXT;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>DB_NOTFOUND)</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pcursor-&gt;close();</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>runtime_error(</highlight><highlight class="stringliteral">&quot;CWalletDB::ListAccountCreditDebit()<sp/>:<sp/>error<sp/>scanning<sp/>DB&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unserialize</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal"><sp/>strType;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>strType;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;acentry&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref><sp/>acentry;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>acentry.<ref refid="class_c_accounting_entry_1a01434c1b0edad576bc1584c9b667ce1d" kindref="member">strAccount</ref>;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!fAllAccounts<sp/>&amp;&amp;<sp/>acentry.<ref refid="class_c_accounting_entry_1a01434c1b0edad576bc1584c9b667ce1d" kindref="member">strAccount</ref><sp/>!=<sp/>strAccount)</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>acentry;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>acentry.nEntryNo;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entries.push_back(acentry);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>pcursor-&gt;close();</highlight></codeline>
<codeline lineno="261"><highlight class="normal">}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263" refid="class_c_wallet_d_b_1afc27d9c9eef8b31851e6b02dc3191425" refkind="member"><highlight class="normal"><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944" kindref="member">DBErrors</ref><sp/><ref refid="class_c_wallet_d_b_1afc27d9c9eef8b31851e6b02dc3191425" kindref="member">CWalletDB::ReorderTransactions</ref>(<ref refid="class_c_wallet" kindref="compound">CWallet</ref>*<sp/>pwallet)</highlight></codeline>
<codeline lineno="264"><highlight class="normal">{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(pwallet-&gt;<ref refid="class_c_wallet_1a4e6eb889f7638ed9695fdc0731581428" kindref="member">cs_wallet</ref>);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Old<sp/>wallets<sp/>didn&apos;t<sp/>have<sp/>any<sp/>defined<sp/>order<sp/>for<sp/>transactions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Probably<sp/>a<sp/>bad<sp/>idea<sp/>to<sp/>change<sp/>the<sp/>output<sp/>of<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First:<sp/>get<sp/>all<sp/>CWalletTx<sp/>and<sp/>CAccountingEntry<sp/>into<sp/>a<sp/>sorted-by-time<sp/>multimap.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>pair&lt;CWalletTx*,<sp/>CAccountingEntry*&gt;<sp/>TxPair;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>multimap&lt;int64_t,<sp/>TxPair<sp/>&gt;<sp/>TxItems;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>TxItems<sp/>txByTime;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(map&lt;uint256,<sp/>CWalletTx&gt;::iterator<sp/>it<sp/>=<sp/>pwallet-&gt;<ref refid="class_c_wallet_1a0b17f72f2170090f2de43a6c48af3214" kindref="member">mapWallet</ref>.begin();<sp/>it<sp/>!=<sp/>pwallet-&gt;<ref refid="class_c_wallet_1a0b17f72f2170090f2de43a6c48af3214" kindref="member">mapWallet</ref>.end();<sp/>++it)</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_tx" kindref="compound">CWalletTx</ref>*<sp/>wtx<sp/>=<sp/>&amp;((*it).second);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>txByTime.insert(make_pair(wtx-&gt;<ref refid="class_c_wallet_tx_1af4f4b58875061467026da7b259532b69" kindref="member">nTimeReceived</ref>,<sp/>TxPair(wtx,<sp/>(<ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref>*)0)));</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>list&lt;CAccountingEntry&gt;<sp/>acentries;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>ListAccountCreditDebit(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/>acentries);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>BOOST_FOREACH(<ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref>&amp;<sp/>entry,<sp/>acentries)</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>txByTime.insert(make_pair(entry.<ref refid="class_c_accounting_entry_1a416a4eb8d47e4c4cfdfc366d9d777ae6" kindref="member">nTime</ref>,<sp/>TxPair((<ref refid="class_c_wallet_tx" kindref="compound">CWalletTx</ref>*)0,<sp/>&amp;entry)));</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref>&amp;<sp/>nOrderPosNext<sp/>=<sp/>pwallet-&gt;<ref refid="class_c_wallet_1af56cb17b19742506fc8d9449fc60884e" kindref="member">nOrderPosNext</ref>;</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>nOrderPosNext<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;int64_t&gt;<sp/>nOrderPosOffsets;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(TxItems::iterator<sp/>it<sp/>=<sp/>txByTime.begin();<sp/>it<sp/>!=<sp/>txByTime.end();<sp/>++it)</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_tx" kindref="compound">CWalletTx</ref><sp/>*</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>pwtx<sp/>=<sp/>(*it).second.first;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref><sp/>*</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>pacentry<sp/>=<sp/>(*it).second.second;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref>&amp;<sp/>nOrderPos<sp/>=<sp/>(pwtx<sp/>!=<sp/>0)<sp/>?<sp/>pwtx-&gt;<ref refid="class_c_wallet_tx_1af51e160ff1d9d78986e9f239c7ac7a35" kindref="member">nOrderPos</ref><sp/>:<sp/>pacentry-&gt;<ref refid="class_c_accounting_entry_1a9c5f78f13a657c1f1fc860a70ef072d5" kindref="member">nOrderPos</ref>;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(nOrderPos<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nOrderPos<sp/>=<sp/>nOrderPosNext++;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nOrderPosOffsets.push_back(nOrderPos);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pwtx)</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!WriteTx(pwtx-&gt;<ref refid="class_c_transaction_1a3f8666d2a275c40da14bd5eaf47dc004" kindref="member">GetHash</ref>(),<sp/>*pwtx))</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c" kindref="member">DB_LOAD_FAIL</ref>;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!WriteAccountingEntry(pacentry-&gt;<ref refid="class_c_accounting_entry_1a0c35da8adbbc529238af70964e0d2b29" kindref="member">nEntryNo</ref>,<sp/>*pacentry))</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c" kindref="member">DB_LOAD_FAIL</ref>;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nOrderPosOff<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_FOREACH(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref>&amp;<sp/>nOffsetStart,<sp/>nOrderPosOffsets)</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nOrderPos<sp/>&gt;=<sp/>nOffsetStart)</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++nOrderPosOff;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nOrderPos<sp/>+=<sp/>nOrderPosOff;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nOrderPosNext<sp/>=<sp/>std::max(nOrderPosNext,<sp/>nOrderPos<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!nOrderPosOff)</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>we&apos;re<sp/>changing<sp/>the<sp/>order,<sp/>write<sp/>it<sp/>back</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pwtx)</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!WriteTx(pwtx-&gt;<ref refid="class_c_transaction_1a3f8666d2a275c40da14bd5eaf47dc004" kindref="member">GetHash</ref>(),<sp/>*pwtx))</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c" kindref="member">DB_LOAD_FAIL</ref>;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!WriteAccountingEntry(pacentry-&gt;<ref refid="class_c_accounting_entry_1a0c35da8adbbc529238af70964e0d2b29" kindref="member">nEntryNo</ref>,<sp/>*pacentry))</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944ab5a338e1c914e0d9107fab0dbcd3c64c" kindref="member">DB_LOAD_FAIL</ref>;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/>WriteOrderPosNext(nOrderPosNext);</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2" kindref="member">DB_LOAD_OK</ref>;</highlight></codeline>
<codeline lineno="337"><highlight class="normal">}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339" refid="class_c_wallet_scan_state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_c_wallet_scan_state" kindref="compound">CWalletScanState</ref><sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="341" refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" kindref="member">nKeys</ref>;</highlight></codeline>
<codeline lineno="342" refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" kindref="member">nCKeys</ref>;</highlight></codeline>
<codeline lineno="343" refid="class_c_wallet_scan_state_1a2cfbc8894839188b57be22e72f2d6de4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_scan_state_1a2cfbc8894839188b57be22e72f2d6de4" kindref="member">nKeyMeta</ref>;</highlight></codeline>
<codeline lineno="344" refid="class_c_wallet_scan_state_1a13c5139c5966079d1be4c739666c5243" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_scan_state_1a13c5139c5966079d1be4c739666c5243" kindref="member">fIsEncrypted</ref>;</highlight></codeline>
<codeline lineno="345" refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" kindref="member">fAnyUnordered</ref>;</highlight></codeline>
<codeline lineno="346" refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref>;</highlight></codeline>
<codeline lineno="347" refid="class_c_wallet_scan_state_1a6cbf626ca5a0275f0469684f22dff12f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>vector&lt;uint256&gt;<sp/><ref refid="class_c_wallet_scan_state_1a6cbf626ca5a0275f0469684f22dff12f" kindref="member">vWalletUpgrade</ref>;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349" refid="class_c_wallet_scan_state_1a8012f2b0c336f7ee0b842d875f4fa4e6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_scan_state_1a8012f2b0c336f7ee0b842d875f4fa4e6" kindref="member">CWalletScanState</ref>()<sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nKeys<sp/>=<sp/>nCKeys<sp/>=<sp/>nKeyMeta<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fIsEncrypted<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fAnyUnordered<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nFileVersion<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="355"><highlight class="normal">};</highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357" refid="walletdb_8cpp_1ad1f171cf096f5479805a06fc20480343" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="walletdb_8cpp_1ad1f171cf096f5479805a06fc20480343" kindref="member">ReadKeyValue</ref>(<ref refid="class_c_wallet" kindref="compound">CWallet</ref>*<sp/>pwallet,<sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref>&amp;<sp/>ssKey,<sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref>&amp;<sp/>ssValue,</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_scan_state" kindref="compound">CWalletScanState</ref><sp/>&amp;wss,<sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strType,<sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strErr)</highlight></codeline>
<codeline lineno="359"><highlight class="normal">{</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unserialize</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Taking<sp/>advantage<sp/>of<sp/>the<sp/>fact<sp/>that<sp/>pair<sp/>serialization</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>just<sp/>the<sp/>two<sp/>items<sp/>serialized<sp/>one<sp/>after<sp/>the<sp/>other</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>strType;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal"><sp/>strAddress;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>strAddress;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>pwallet-&gt;<ref refid="class_c_wallet_1afed31f2489c987e0f76233121ed84ab7" kindref="member">mapAddressBook</ref>[<ref refid="class_c_dark_silk_address" kindref="compound">CDarkSilkAddress</ref>(strAddress).<ref refid="class_c_dark_silk_address_1a907e63758c7914a246b5807f6babf97d" kindref="member">Get</ref>()];</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;tx&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>;</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_tx" kindref="compound">CWalletTx</ref>&amp;<sp/>wtx<sp/>=<sp/>pwallet-&gt;<ref refid="class_c_wallet_1a0b17f72f2170090f2de43a6c48af3214" kindref="member">mapWallet</ref>[<ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>];</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>wtx;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_validation_state" kindref="compound">CValidationState</ref><sp/><ref refid="db__test_8cc_1a42432b4356adce5579ccf597f6e83e54" kindref="member">state</ref>;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(wtx.CheckTransaction(state)<sp/>&amp;&amp;<sp/>(wtx.GetHash()<sp/>==<sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>)<sp/>&amp;&amp;<sp/>state.<ref refid="class_c_validation_state_1af4c51946b39b2234b8004d58fbc164a5" kindref="member">IsValid</ref>()))</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Undo<sp/>serialize<sp/>changes<sp/>in<sp/>31600</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(31404<sp/>&lt;=<sp/>wtx.fTimeReceivedIsTxTime<sp/>&amp;&amp;<sp/>wtx.fTimeReceivedIsTxTime<sp/>&lt;=<sp/>31703)</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ssValue.<ref refid="class_c_data_stream_1a6e50e788d33080ac804e4d8ba7150279" kindref="member">empty</ref>())</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>fTmp;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>fUnused;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>fTmp<sp/>&gt;&gt;<sp/>fUnused<sp/>&gt;&gt;<sp/>wtx.strFromAccount;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;LoadWallet()<sp/>upgrading<sp/>tx<sp/>ver=%d<sp/>%d<sp/>&apos;%s&apos;<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtx.fTimeReceivedIsTxTime,<sp/>fTmp,<sp/>wtx.strFromAccount,<sp/>hash.ToString());</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtx.fTimeReceivedIsTxTime<sp/>=<sp/>fTmp;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;LoadWallet()<sp/>repairing<sp/>tx<sp/>ver=%d<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>wtx.fTimeReceivedIsTxTime,<sp/>hash.ToString());</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtx.fTimeReceivedIsTxTime<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1a6cbf626ca5a0275f0469684f22dff12f" kindref="member">vWalletUpgrade</ref>.push_back(hash);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wtx.nOrderPos<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" kindref="member">fAnyUnordered</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1adf34c789fd6eab1eeed22ef16837f558" kindref="member">AddToWallet</ref>(wtx,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//LogPrintf(&quot;LoadWallet<sp/><sp/>%s\n&quot;,<sp/>wtx.GetHash().ToString());</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//LogPrintf(&quot;<sp/>%12d<sp/><sp/>%s<sp/><sp/>%s<sp/><sp/>%s\n&quot;,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>wtx.vout[0].nValue,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>DateTimeStrFormat(&quot;%x<sp/>%H:%M:%S&quot;,<sp/>wtx.GetBlockTime()),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>wtx.hashBlock.ToString(),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>wtx.mapValue[&quot;message&quot;]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;sxAddr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="util_8cpp_1a2ba7badc843121dde40a6f109d224a42" kindref="member">fDebug</ref>)</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(</highlight><highlight class="stringliteral">&quot;WalletDB<sp/>ReadKeyValue<sp/>sxAddr\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_stealth_address" kindref="compound">CStealthAddress</ref><sp/>sxAddr;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>sxAddr;</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a148a31a8069304a6593b3c5266417b10" kindref="member">stealthAddresses</ref>.insert(sxAddr);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;acentry&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal"><sp/>strAccount;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>strAccount;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref><sp/>nNumber;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>nNumber;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nNumber<sp/>&gt;<sp/>nAccountingEntryNumber)</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nAccountingEntryNumber<sp/>=<sp/>nNumber;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!wss.<ref refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" kindref="member">fAnyUnordered</ref>)</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_accounting_entry" kindref="compound">CAccountingEntry</ref><sp/>acentry;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>acentry;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(acentry.nOrderPos<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" kindref="member">fAnyUnordered</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;watchonly&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>script;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>script;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>fYes;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>fYes;</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fYes<sp/>==<sp/></highlight><highlight class="charliteral">&apos;1&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1ad6580f1844fc639389e1c6a1e2787ee6" kindref="member">LoadWatchOnly</ref>(script);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Watch-only<sp/>addresses<sp/>have<sp/>no<sp/>birthday<sp/>information<sp/>for<sp/>now,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>set<sp/>the<sp/>wallet<sp/>birthday<sp/>to<sp/>the<sp/>beginning<sp/>of<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a817c0d1034377a7bd70a714140a5a8ca" kindref="member">nTimeFirstKey</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;key&quot;</highlight><highlight class="normal"><sp/>||<sp/>strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;wkey&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref><sp/>vchPubKey;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>vchPubKey;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!vchPubKey.IsValid())</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>CPubKey<sp/>corrupt&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_key" kindref="compound">CKey</ref><sp/>key;</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="key_8h_1a1da569b8b6e5b3fa1196cc1b877e7f54" kindref="member">CPrivKey</ref><sp/>pkey;</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;key&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" kindref="member">nKeys</ref>++;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>pkey;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_key" kindref="compound">CWalletKey</ref><sp/>wkey;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>wkey;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkey<sp/>=<sp/>wkey.<ref refid="class_c_wallet_key_1a28f9bbffcc9d7f2f784d5e4be8ca31f7" kindref="member">vchPrivKey</ref>;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Old<sp/>wallets<sp/>store<sp/>keys<sp/>as<sp/>&quot;key&quot;<sp/>[pubkey]<sp/>=&gt;<sp/>[privkey]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>...<sp/>which<sp/>was<sp/>slow<sp/>for<sp/>wallets<sp/>with<sp/>lots<sp/>of<sp/>keys,<sp/>because<sp/>the<sp/>public<sp/>key<sp/>is<sp/>re-derived<sp/>from<sp/>the<sp/>private<sp/>key</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>using<sp/>EC<sp/>operations<sp/>as<sp/>a<sp/>checksum.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Newer<sp/>wallets<sp/>store<sp/>keys<sp/>as<sp/>&quot;key&quot;[pubkey]<sp/>=&gt;<sp/>[privkey][hash(pubkey,privkey)],<sp/>which<sp/>is<sp/>much<sp/>faster<sp/>while</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remaining<sp/>backwards-compatible.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>;</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal">(...){}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fSkipCheck<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hash<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>hash<sp/>pubkey/privkey<sp/>to<sp/>accelerate<sp/>wallet<sp/>load</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchKey;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchKey.reserve(vchPubKey.size()<sp/>+<sp/>pkey.size());</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchKey.insert(vchKey.end(),<sp/>vchPubKey.begin(),<sp/>vchPubKey.end());</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchKey.insert(vchKey.end(),<sp/>pkey.begin(),<sp/>pkey.end());</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="hash_8h_1ab3f6c437460137530d86e09c2c102e99" kindref="member">Hash</ref>(vchKey.begin(),<sp/>vchKey.end())<sp/>!=<sp/>hash)</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>CPubKey/CPrivKey<sp/>corrupt&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fSkipCheck<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!key.<ref refid="class_c_key_1a141751588f8bfe5f1b6fc27f4e64b63f" kindref="member">Load</ref>(pkey,<sp/>vchPubKey,<sp/>fSkipCheck))</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>CPrivKey<sp/>corrupt&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pwallet-&gt;<ref refid="class_c_wallet_1a439bab81d7989f91a4f0909960516eea" kindref="member">LoadKey</ref>(key,<sp/>vchPubKey))</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>LoadKey<sp/>failed&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;mkey&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nID;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>nID;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_master_key" kindref="compound">CMasterKey</ref><sp/>kMasterKey;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>kMasterKey;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(pwallet-&gt;<ref refid="class_c_wallet_1a23c5badf56c297a95557af3073d4aa32" kindref="member">mapMasterKeys</ref>.count(nID)<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>duplicate<sp/>CMasterKey<sp/>id<sp/>%u&quot;</highlight><highlight class="normal">,<sp/>nID);</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a23c5badf56c297a95557af3073d4aa32" kindref="member">mapMasterKeys</ref>[nID]<sp/>=<sp/>kMasterKey;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pwallet-&gt;<ref refid="class_c_wallet_1aecfc6e4a6ea958ec369ca77d790271e3" kindref="member">nMasterKeyMaxID</ref><sp/>&lt;<sp/>nID)</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1aecfc6e4a6ea958ec369ca77d790271e3" kindref="member">nMasterKeyMaxID</ref><sp/>=<sp/>nID;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;ckey&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" kindref="member">nCKeys</ref>++;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vector&lt;unsigned<sp/>char&gt;<sp/>vchPubKey;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>vchPubKey;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vector&lt;unsigned<sp/>char&gt;<sp/>vchPrivKey;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>vchPrivKey;</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pwallet-&gt;<ref refid="class_c_wallet_1a01fbd78238d4ef833d059f12a7e8ac9f" kindref="member">LoadCryptedKey</ref>(vchPubKey,<sp/>vchPrivKey))</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>LoadCryptedKey<sp/>failed&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1a13c5139c5966079d1be4c739666c5243" kindref="member">fIsEncrypted</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;keymeta&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref><sp/>vchPubKey;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>vchPubKey;</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_key_metadata" kindref="compound">CKeyMetadata</ref><sp/>keyMeta;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>keyMeta;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1a2cfbc8894839188b57be22e72f2d6de4" kindref="member">nKeyMeta</ref>++;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a21e6580474514f838dfe1446890085a4" kindref="member">LoadKeyMetadata</ref>(vchPubKey,<sp/>keyMeta);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>earliest<sp/>key<sp/>creation<sp/>time,<sp/>as<sp/>wallet<sp/>birthday</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pwallet-&gt;<ref refid="class_c_wallet_1a817c0d1034377a7bd70a714140a5a8ca" kindref="member">nTimeFirstKey</ref><sp/>||</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(keyMeta.nCreateTime<sp/>&lt;<sp/>pwallet-&gt;<ref refid="class_c_wallet_1a817c0d1034377a7bd70a714140a5a8ca" kindref="member">nTimeFirstKey</ref>))</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a817c0d1034377a7bd70a714140a5a8ca" kindref="member">nTimeFirstKey</ref><sp/>=<sp/>keyMeta.nCreateTime;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;sxKeyMeta&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="util_8cpp_1a2ba7badc843121dde40a6f109d224a42" kindref="member">fDebug</ref>)</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(</highlight><highlight class="stringliteral">&quot;WalletDB<sp/>ReadKeyValue<sp/>sxKeyMeta\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_key_i_d" kindref="compound">CKeyID</ref><sp/>keyId;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>keyId;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_stealth_key_metadata" kindref="compound">CStealthKeyMetadata</ref><sp/>sxKeyMeta;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>sxKeyMeta;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1aeb612f84011f0b02c070c2d39594b9fb" kindref="member">mapStealthKeyMeta</ref>[keyId]<sp/>=<sp/>sxKeyMeta;</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;defaultkey&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>pwallet-&gt;<ref refid="class_c_wallet_1a6d415899e530a91e6e28dd0fa4ecef8d" kindref="member">vchDefaultKey</ref>;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;pool&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nIndex;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/>nIndex;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_key_pool" kindref="compound">CKeyPool</ref><sp/>keypool;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>keypool;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a363fabb2b82d596c33e4fa3920a11c26" kindref="member">setKeyPool</ref>.insert(nIndex);</highlight></codeline>
<codeline lineno="586"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>no<sp/>metadata<sp/>exists<sp/>yet,<sp/>create<sp/>a<sp/>default<sp/>with<sp/>the<sp/>pool<sp/>key&apos;s</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>creation<sp/>time.<sp/>Note<sp/>that<sp/>this<sp/>may<sp/>be<sp/>overwritten<sp/>by<sp/>actually</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>stored<sp/>metadata<sp/>for<sp/>that<sp/>key<sp/>later,<sp/>which<sp/>is<sp/>fine.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_key_i_d" kindref="compound">CKeyID</ref><sp/>keyid<sp/>=<sp/>keypool.vchPubKey.GetID();</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pwallet-&gt;<ref refid="class_c_wallet_1acfd09bc5a2daee930f9f988efac8dbb7" kindref="member">mapKeyMetadata</ref>.count(keyid)<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1acfd09bc5a2daee930f9f988efac8dbb7" kindref="member">mapKeyMetadata</ref>[keyid]<sp/>=<sp/><ref refid="class_c_key_metadata" kindref="compound">CKeyMetadata</ref>(keypool.nTime);</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;version&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref>;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref><sp/>==<sp/>10300)</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref><sp/>=<sp/>300;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;cscript&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint160" kindref="compound">uint160</ref><sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssKey<sp/>&gt;&gt;<sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>;</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>script;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>script;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pwallet-&gt;<ref refid="class_c_wallet_1adbf0abef9da8102f000d4afd5cec5bbc" kindref="member">LoadCScript</ref>(script))</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strErr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>wallet<sp/>database:<sp/>LoadCScript<sp/>failed&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;orderposnext&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssValue<sp/>&gt;&gt;<sp/>pwallet-&gt;<ref refid="class_c_wallet_1af56cb17b19742506fc8d9449fc60884e" kindref="member">nOrderPosNext</ref>;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(...)</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="622"><highlight class="normal">}</highlight></codeline>
<codeline lineno="623"><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>IsKeyType(</highlight><highlight class="keywordtype">string</highlight><highlight class="normal"><sp/>strType)</highlight></codeline>
<codeline lineno="625"><highlight class="normal">{</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(strType==<sp/></highlight><highlight class="stringliteral">&quot;key&quot;</highlight><highlight class="normal"><sp/>||<sp/>strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;wkey&quot;</highlight><highlight class="normal"><sp/>||</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;mkey&quot;</highlight><highlight class="normal"><sp/>||<sp/>strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;ckey&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="628"><highlight class="normal">}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630" refid="class_c_wallet_d_b_1a14f26e53502d1a60dd2b034f830acf03" refkind="member"><highlight class="normal"><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944" kindref="member">DBErrors</ref><sp/><ref refid="class_c_wallet_d_b_1a14f26e53502d1a60dd2b034f830acf03" kindref="member">CWalletDB::LoadWallet</ref>(<ref refid="class_c_wallet" kindref="compound">CWallet</ref>*<sp/>pwallet)</highlight></codeline>
<codeline lineno="631"><highlight class="normal">{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a6d415899e530a91e6e28dd0fa4ecef8d" kindref="member">vchDefaultKey</ref><sp/>=<sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>();</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_scan_state" kindref="compound">CWalletScanState</ref><sp/>wss;</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fNoncriticalErrors<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944" kindref="member">DBErrors</ref><sp/>result<sp/>=<sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2" kindref="member">DB_LOAD_OK</ref>;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(pwallet-&gt;<ref refid="class_c_wallet_1a4e6eb889f7638ed9695fdc0731581428" kindref="member">cs_wallet</ref>);</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nMinVersion<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(Read((</highlight><highlight class="keywordtype">string</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;minversion&quot;</highlight><highlight class="normal">,<sp/>nMinVersion))</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nMinVersion<sp/>&gt;<sp/>CLIENT_VERSION)</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944a0e0f7a1f3a38544a975bd97fba1eed58" kindref="member">DB_TOO_NEW</ref>;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a88317da8dab80135b8db73e945e15b60" kindref="member">LoadMinVersion</ref>(nMinVersion);</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>cursor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Dbc*<sp/>pcursor<sp/>=<sp/>GetCursor();</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pcursor)</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Error<sp/>getting<sp/>wallet<sp/>database<sp/>cursor\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655" kindref="member">DB_CORRUPT</ref>;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">true</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Read<sp/>next<sp/>record</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref><sp/>ssKey(<ref refid="serialize_8h_1a6b7b47dd702d9e331586d485013fd1eaa34949680c53028d35a449bf88b3c329d" kindref="member">SER_DISK</ref>,<sp/>CLIENT_VERSION);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref><sp/>ssValue(<ref refid="serialize_8h_1a6b7b47dd702d9e331586d485013fd1eaa34949680c53028d35a449bf88b3c329d" kindref="member">SER_DISK</ref>,<sp/>CLIENT_VERSION);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>ReadAtCursor(pcursor,<sp/>ssKey,<sp/>ssValue);</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>DB_NOTFOUND)</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>next<sp/>record<sp/>from<sp/>wallet<sp/>database\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655" kindref="member">DB_CORRUPT</ref>;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>be<sp/>tolerant<sp/>of<sp/>single<sp/>corrupt<sp/>records:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal"><sp/>strType,<sp/>strErr;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="walletdb_8cpp_1ad1f171cf096f5479805a06fc20480343" kindref="member">ReadKeyValue</ref>(pwallet,<sp/>ssKey,<sp/>ssValue,<sp/>wss,<sp/>strType,<sp/>strErr))</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>losing<sp/>keys<sp/>is<sp/>considered<sp/>a<sp/>catastrophic<sp/>error,<sp/>anything<sp/>else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>assume<sp/>the<sp/>user<sp/>can<sp/>live<sp/>with:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(IsKeyType(strType))</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655" kindref="member">DB_CORRUPT</ref>;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Leave<sp/>other<sp/>errors<sp/>alone,<sp/>if<sp/>we<sp/>try<sp/>to<sp/>fix<sp/>them<sp/>we<sp/>might<sp/>make<sp/>things<sp/>worse.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fNoncriticalErrors<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>...<sp/>but<sp/>do<sp/>warn<sp/>the<sp/>user<sp/>there<sp/>is<sp/>something<sp/>wrong.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strType<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;tx&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rescan<sp/>if<sp/>there<sp/>is<sp/>a<sp/>bad<sp/>transaction<sp/>record:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8cpp_1acb3060cad083d342898b6055e43692ae" kindref="member">SoftSetBoolArg</ref>(</highlight><highlight class="stringliteral">&quot;-rescan&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strErr.empty())</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;%s\n&quot;</highlight><highlight class="normal">,<sp/>strErr);</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pcursor-&gt;close();</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(boost::thread_interrupted)<sp/>{</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(...)<sp/>{</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944a5eb73e7d323c832e22611f0ff94b1655" kindref="member">DB_CORRUPT</ref>;</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fNoncriticalErrors<sp/>&amp;&amp;<sp/>result<sp/>==<sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2" kindref="member">DB_LOAD_OK</ref>)</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944ac83155a59a0d2ca8fc325075f58060c5" kindref="member">DB_NONCRITICAL_ERROR</ref>;</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Any<sp/>wallet<sp/>corruption<sp/>at<sp/>all:<sp/>skip<sp/>any<sp/>rewriting<sp/>or</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>upgrading,<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>make<sp/>it<sp/>worse.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result<sp/>!=<sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944aa2367ec374804930406cea446fbb3fd2" kindref="member">DB_LOAD_OK</ref>)</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;nFileVersion<sp/>=<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref>);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Keys:<sp/>%u<sp/>plaintext,<sp/>%u<sp/>encrypted,<sp/>%u<sp/>w/<sp/>metadata,<sp/>%u<sp/>total\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss.<ref refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" kindref="member">nKeys</ref>,<sp/>wss.<ref refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" kindref="member">nCKeys</ref>,<sp/>wss.<ref refid="class_c_wallet_scan_state_1a2cfbc8894839188b57be22e72f2d6de4" kindref="member">nKeyMeta</ref>,<sp/>wss.<ref refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" kindref="member">nKeys</ref><sp/>+<sp/>wss.<ref refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" kindref="member">nCKeys</ref>);</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>nTimeFirstKey<sp/>is<sp/>only<sp/>reliable<sp/>if<sp/>all<sp/>keys<sp/>have<sp/>metadata</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((wss.<ref refid="class_c_wallet_scan_state_1a8a6e0071320cbfffc6d7d49ded5d506e" kindref="member">nKeys</ref><sp/>+<sp/>wss.<ref refid="class_c_wallet_scan_state_1ae1316ee4cfdf8fbff91ca32a5d0f2b6a" kindref="member">nCKeys</ref>)<sp/>!=<sp/>wss.<ref refid="class_c_wallet_scan_state_1a2cfbc8894839188b57be22e72f2d6de4" kindref="member">nKeyMeta</ref>)</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pwallet-&gt;<ref refid="class_c_wallet_1a817c0d1034377a7bd70a714140a5a8ca" kindref="member">nTimeFirstKey</ref><sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//<sp/>0<sp/>would<sp/>be<sp/>considered<sp/>&apos;no<sp/>value&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"></highlight></codeline>
<codeline lineno="715"><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>BOOST_FOREACH(<ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="cache_8cc_1a11ecb029164e055f28f4123ce3748862" kindref="member">hash</ref>,<sp/>wss.<ref refid="class_c_wallet_scan_state_1a6cbf626ca5a0275f0469684f22dff12f" kindref="member">vWalletUpgrade</ref>)</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WriteTx(hash,<sp/>pwallet-&gt;<ref refid="class_c_wallet_1a0b17f72f2170090f2de43a6c48af3214" kindref="member">mapWallet</ref>[hash]);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rewrite<sp/>encrypted<sp/>wallets<sp/>of<sp/>versions<sp/>0.4.0<sp/>and<sp/>0.5.0rc:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wss.<ref refid="class_c_wallet_scan_state_1a13c5139c5966079d1be4c739666c5243" kindref="member">fIsEncrypted</ref><sp/>&amp;&amp;<sp/>(wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref><sp/>==<sp/>40000<sp/>||<sp/>wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref><sp/>==<sp/>50000))</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="walletdb_8h_1a7558d92e9ea1d446075da1b514c4a944aef89bee2c244fcd980d6cf7edc5bf2d6" kindref="member">DB_NEED_REWRITE</ref>;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wss.<ref refid="class_c_wallet_scan_state_1ad68ce61566ee2baf3d7b04b1390942d1" kindref="member">nFileVersion</ref><sp/>&lt;<sp/>CLIENT_VERSION)<sp/></highlight><highlight class="comment">//<sp/>Update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WriteVersion(CLIENT_VERSION);</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wss.<ref refid="class_c_wallet_scan_state_1acafa7b6a27ec1a4714e9a7b331067e9d" kindref="member">fAnyUnordered</ref>)</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/>ReorderTransactions(pwallet);</highlight></codeline>
<codeline lineno="728"><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="730"><highlight class="normal">}</highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="732" refid="walletdb_8cpp_1a571e13707ba159c7c047875764ae5e2b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="walletdb_8cpp_1a571e13707ba159c7c047875764ae5e2b" kindref="member">ThreadFlushWalletDB</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strFile)</highlight></codeline>
<codeline lineno="733"><highlight class="normal">{</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>this<sp/>thread<sp/>recognisable<sp/>as<sp/>the<sp/>wallet<sp/>flushing<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="util_8cpp_1a85fc1244e0bd3c91ee7a1c05ed10ebbb" kindref="member">RenameThread</ref>(</highlight><highlight class="stringliteral">&quot;darksilk-wallet&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fOneThread;</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fOneThread)</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/>fOneThread<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="util_8cpp_1a64d956f1dda7f9a80ab5d594532b906d" kindref="member">GetBoolArg</ref>(</highlight><highlight class="stringliteral">&quot;-flushwallet&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="743"><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nLastSeen<sp/>=<sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nLastFlushed<sp/>=<sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>;</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nLastWalletUpdate<sp/>=<sp/><ref refid="util_8cpp_1a46fac5fba8ba905b5f9acb364f5d8c6f" kindref="member">GetTime</ref>();</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">true</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1ac635182d3e845eda4af4fa5ab31609da" kindref="member">MilliSleep</ref>(500);</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nLastSeen<sp/>!=<sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>)</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nLastSeen<sp/>=<sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>;</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nLastWalletUpdate<sp/>=<sp/><ref refid="util_8cpp_1a46fac5fba8ba905b5f9acb364f5d8c6f" kindref="member">GetTime</ref>();</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nLastFlushed<sp/>!=<sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref><sp/>&amp;&amp;<sp/><ref refid="util_8cpp_1a46fac5fba8ba905b5f9acb364f5d8c6f" kindref="member">GetTime</ref>()<sp/>-<sp/>nLastWalletUpdate<sp/>&gt;=<sp/>2)</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1aca08e7299069c2d60b8aa726fc550612" kindref="member">TRY_LOCK</ref>(<ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1af71bf28f9142c38aedc550353270b2b7" kindref="member">cs_db</ref>,lockDb);</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lockDb)</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Don&apos;t<sp/>do<sp/>this<sp/>if<sp/>any<sp/>databases<sp/>are<sp/>in<sp/>use</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nRefCount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>map&lt;string,<sp/>int&gt;::iterator<sp/>mi<sp/>=<sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.begin();</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(mi<sp/>!=<sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.end())</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nRefCount<sp/>+=<sp/>(*mi).second;</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mi++;</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nRefCount<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boost::this_thread::interruption_point();</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>map&lt;string,<sp/>int&gt;::iterator<sp/>mi<sp/>=<sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.find(strFile);</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mi<sp/>!=<sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.end())</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LogPrint(</highlight><highlight class="stringliteral">&quot;db&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Flushing<sp/>wallet.dat\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nLastFlushed<sp/>=<sp/><ref refid="db_8cpp_1aad0b4d8ce794391063e82239d0a20b09" kindref="member">nWalletDBUpdated</ref>;</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>nStart<sp/>=<sp/><ref refid="util_8h_1a139d0fe6387b9e230a9b8bb12d9b43b9" kindref="member">GetTimeMillis</ref>();</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Flush<sp/>wallet.dat<sp/>so<sp/>it&apos;s<sp/>self<sp/>contained</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1ac53fd53afdd1e0881b8ffbb11a89b556" kindref="member">CloseDb</ref>(strFile);</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1aa4e0fe52dfc0da22fe9bf59eeda57fba" kindref="member">CheckpointLSN</ref>(strFile);</highlight></codeline>
<codeline lineno="784"><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.erase(mi++);</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LogPrint(</highlight><highlight class="stringliteral">&quot;db&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Flushed<sp/>wallet.dat<sp/>%dms\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="util_8h_1a139d0fe6387b9e230a9b8bb12d9b43b9" kindref="member">GetTimeMillis</ref>()<sp/>-<sp/>nStart);</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="792"><highlight class="normal">}</highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794" refid="walletdb_8cpp_1a273c3692765c732c5f724cec93e6b62f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="walletdb_8cpp_1a273c3692765c732c5f724cec93e6b62f" kindref="member">BackupWallet</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet" kindref="compound">CWallet</ref>&amp;<sp/>wallet,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal">&amp;<sp/>strDest)</highlight></codeline>
<codeline lineno="795"><highlight class="normal">{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!wallet.<ref refid="class_c_wallet_1a1b2e285b4d7bd105c792941aa666249c" kindref="member">fFileBacked</ref>)</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">true</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1af71bf28f9142c38aedc550353270b2b7" kindref="member">cs_db</ref>);</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.count(wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>)<sp/>||<sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>[wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>]<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Flush<sp/>log<sp/>data<sp/>to<sp/>the<sp/>dat<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1ac53fd53afdd1e0881b8ffbb11a89b556" kindref="member">CloseDb</ref>(wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>);</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1aa4e0fe52dfc0da22fe9bf59eeda57fba" kindref="member">CheckpointLSN</ref>(wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>);</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db_8cpp_1a0e3d95be19da4a302447fa44703b1979" kindref="member">bitdb</ref>.<ref refid="class_c_d_b_env_1a3b8a3caf48395ef3f05e3717b33bf32c" kindref="member">mapFileUseCount</ref>.erase(wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>);</highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Copy<sp/>wallet.dat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filesystem::path<sp/>pathSrc<sp/>=<sp/><ref refid="util_8cpp_1ab83866a054745d4b30a3948a1b44beba" kindref="member">GetDataDir</ref>()<sp/>/<sp/>wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>;</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filesystem::path<sp/>pathDest(strDest);</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(filesystem::is_directory(pathDest))</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pathDest<sp/>/=<sp/>wallet.<ref refid="class_c_wallet_1a3e886f3a3b20228770e082b3fc014fc7" kindref="member">strWalletFile</ref>;</highlight></codeline>
<codeline lineno="814"><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>BOOST_VERSION<sp/>&gt;=<sp/>104000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filesystem::copy_file(pathSrc,<sp/>pathDest,<sp/>filesystem::copy_option::overwrite_if_exists);</highlight></codeline>
<codeline lineno="818"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filesystem::copy_file(pathSrc,<sp/>pathDest);</highlight></codeline>
<codeline lineno="820"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;copied<sp/>wallet.dat<sp/>to<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>pathDest.string());</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal">(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>filesystem::filesystem_error<sp/>&amp;e)<sp/>{</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;error<sp/>copying<sp/>wallet.dat<sp/>to<sp/>%s<sp/>-<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>pathDest.string(),<sp/>e.what());</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1ac635182d3e845eda4af4fa5ab31609da" kindref="member">MilliSleep</ref>(100);</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="832"><highlight class="normal">}</highlight></codeline>
<codeline lineno="833"><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>(very<sp/>carefully!)<sp/>recover<sp/>wallet.dat<sp/>if<sp/>there<sp/>is<sp/>a<sp/>problem.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="837" refid="class_c_wallet_d_b_1a3ebeb12f37d9c66512e2bc2903a6854a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a3ebeb12f37d9c66512e2bc2903a6854a" kindref="member">CWalletDB::Recover</ref>(<ref refid="class_c_d_b_env" kindref="compound">CDBEnv</ref>&amp;<sp/>dbenv,<sp/>std::string<sp/>filename,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fOnlyKeys)</highlight></codeline>
<codeline lineno="838"><highlight class="normal">{</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Recovery<sp/>procedure:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>move<sp/>wallet.dat<sp/>to<sp/>wallet.timestamp.bak</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>Salvage<sp/>with<sp/>fAggressive=true<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>as<sp/>much<sp/>data<sp/>as<sp/>possible.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rewrite<sp/>salvaged<sp/>data<sp/>to<sp/>wallet.dat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>-rescan<sp/>so<sp/>any<sp/>missing<sp/>transactions<sp/>will<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>found.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/>now<sp/>=<sp/><ref refid="util_8cpp_1a46fac5fba8ba905b5f9acb364f5d8c6f" kindref="member">GetTime</ref>();</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>newFilename<sp/>=<sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;wallet.%d.bak&quot;</highlight><highlight class="normal">,<sp/>now);</highlight></codeline>
<codeline lineno="848"><highlight class="normal"></highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>result<sp/>=<sp/>dbenv.<ref refid="class_c_d_b_env_1a50a70690e7f688f5e92a972e7fa18668" kindref="member">dbenv</ref>.dbrename(NULL,<sp/>filename.c_str(),<sp/>NULL,</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFilename.c_str(),<sp/>DB_AUTO_COMMIT);</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Renamed<sp/>%s<sp/>to<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>filename,<sp/>newFilename);</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>rename<sp/>%s<sp/>to<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>filename,<sp/>newFilename);</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="858"><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;CDBEnv::KeyValPair&gt;<sp/>salvagedData;</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>allOK<sp/>=<sp/>dbenv.<ref refid="class_c_d_b_env_1a08726637bff0809ab9c7c493383a3914" kindref="member">Salvage</ref>(newFilename,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>salvagedData);</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(salvagedData.empty())</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Salvage(aggressive)<sp/>found<sp/>no<sp/>records<sp/>in<sp/>%s.\n&quot;</highlight><highlight class="normal">,<sp/>newFilename);</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Salvage(aggressive)<sp/>found<sp/>%u<sp/>records\n&quot;</highlight><highlight class="normal">,<sp/>salvagedData.size());</highlight></codeline>
<codeline lineno="867"><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fSuccess<sp/>=<sp/>allOK;</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/>Db*<sp/>pdbCopy<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Db(&amp;dbenv.<ref refid="class_c_d_b_env_1a50a70690e7f688f5e92a972e7fa18668" kindref="member">dbenv</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>pdbCopy-&gt;open(NULL,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Txn<sp/>pointer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filename.c_str(),<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Filename</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;main&quot;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Logical<sp/>db<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DB_BTREE,<sp/><sp/></highlight><highlight class="comment">//<sp/>Database<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DB_CREATE,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Flags</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0);</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>&gt;<sp/>0)</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>create<sp/>database<sp/>file<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>filename);</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_wallet" kindref="compound">CWallet</ref><sp/>dummyWallet;</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_wallet_scan_state" kindref="compound">CWalletScanState</ref><sp/>wss;</highlight></codeline>
<codeline lineno="883"><highlight class="normal"></highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/>DbTxn*<sp/>ptxn<sp/>=<sp/>dbenv.<ref refid="class_c_d_b_env_1a5f1daab338b2098ea693efad6edefb9b" kindref="member">TxnBegin</ref>();</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/>BOOST_FOREACH(<ref refid="class_c_d_b_env_1a53fd285f09c312973caa6f90b33937f5" kindref="member">CDBEnv::KeyValPair</ref>&amp;<sp/>row,<sp/>salvagedData)</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fOnlyKeys)</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref><sp/>ssKey(row.first,<sp/><ref refid="serialize_8h_1a6b7b47dd702d9e331586d485013fd1eaa34949680c53028d35a449bf88b3c329d" kindref="member">SER_DISK</ref>,<sp/>CLIENT_VERSION);</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_data_stream" kindref="compound">CDataStream</ref><sp/>ssValue(row.second,<sp/><ref refid="serialize_8h_1a6b7b47dd702d9e331586d485013fd1eaa34949680c53028d35a449bf88b3c329d" kindref="member">SER_DISK</ref>,<sp/>CLIENT_VERSION);</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">string</highlight><highlight class="normal"><sp/>strType,<sp/>strErr;</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fReadOK<sp/>=<sp/><ref refid="walletdb_8cpp_1ad1f171cf096f5479805a06fc20480343" kindref="member">ReadKeyValue</ref>(&amp;dummyWallet,<sp/>ssKey,<sp/>ssValue,</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wss,<sp/>strType,<sp/>strErr);</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!IsKeyType(strType))</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!fReadOK)</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="util_8h_1afc02c0a4258fedfb316be612bb659ba8" kindref="member">LogPrintf</ref>(</highlight><highlight class="stringliteral">&quot;WARNING:<sp/>CWalletDB::Recover<sp/>skipping<sp/>%s:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>strType,<sp/>strErr);</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Dbt<sp/>datKey(&amp;row.first[0],<sp/>row.first.size());</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Dbt<sp/>datValue(&amp;row.second[0],<sp/>row.second.size());</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret2<sp/>=<sp/>pdbCopy-&gt;put(ptxn,<sp/>&amp;datKey,<sp/>&amp;datValue,<sp/>DB_NOOVERWRITE);</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret2<sp/>&gt;<sp/>0)</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fSuccess<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/>ptxn-&gt;commit(0);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/>pdbCopy-&gt;close(0);</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>pdbCopy;</highlight></codeline>
<codeline lineno="911"><highlight class="normal"></highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fSuccess;</highlight></codeline>
<codeline lineno="913"><highlight class="normal">}</highlight></codeline>
<codeline lineno="914"><highlight class="normal"></highlight></codeline>
<codeline lineno="915" refid="class_c_wallet_d_b_1a44388f1c3ee63191dcb78b1001e9390c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a3ebeb12f37d9c66512e2bc2903a6854a" kindref="member">CWalletDB::Recover</ref>(<ref refid="class_c_d_b_env" kindref="compound">CDBEnv</ref>&amp;<sp/>dbenv,<sp/>std::string<sp/>filename)</highlight></codeline>
<codeline lineno="916"><highlight class="normal">{</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_wallet_d_b_1a3ebeb12f37d9c66512e2bc2903a6854a" kindref="member">CWalletDB::Recover</ref>(dbenv,<sp/>filename,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="918"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="/home/dev/ds-160209/src/walletdb.cpp"/>
  </compounddef>
</doxygen>
