<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.9.1">
  <compounddef id="table__builder_8cc" kind="file" language="C++">
    <compoundname>table_builder.cc</compoundname>
    <includes refid="table__builder_8h" local="yes">leveldb/table_builder.h</includes>
    <includes local="no">assert.h</includes>
    <includes refid="comparator_8h" local="yes">leveldb/comparator.h</includes>
    <includes refid="env_8h" local="yes">leveldb/env.h</includes>
    <includes refid="filter__policy_8h" local="yes">leveldb/filter_policy.h</includes>
    <includes refid="options_8h" local="yes">leveldb/options.h</includes>
    <includes refid="block__builder_8h" local="yes">table/block_builder.h</includes>
    <includes refid="filter__block_8h" local="yes">table/filter_block.h</includes>
    <includes refid="format_8h" local="yes">table/format.h</includes>
    <includes refid="coding_8h" local="yes">util/coding.h</includes>
    <includes refid="crc32c_8h" local="yes">util/crc32c.h</includes>
    <incdepgraph>
      <node id="39416">
        <label>stdarg.h</label>
      </node>
      <node id="39403">
        <label>/home/dev/ds-160209/src/leveldb/table/table_builder.cc</label>
        <link refid="table_builder.cc"/>
        <childnode refid="39404" relation="include">
        </childnode>
        <childnode refid="39411" relation="include">
        </childnode>
        <childnode refid="39413" relation="include">
        </childnode>
        <childnode refid="39414" relation="include">
        </childnode>
        <childnode refid="39417" relation="include">
        </childnode>
        <childnode refid="39406" relation="include">
        </childnode>
        <childnode refid="39418" relation="include">
        </childnode>
        <childnode refid="39419" relation="include">
        </childnode>
        <childnode refid="39421" relation="include">
        </childnode>
        <childnode refid="39422" relation="include">
        </childnode>
        <childnode refid="39424" relation="include">
        </childnode>
      </node>
      <node id="39411">
        <label>assert.h</label>
      </node>
      <node id="39406">
        <label>leveldb/options.h</label>
        <link refid="options_8h"/>
        <childnode refid="39407" relation="include">
        </childnode>
      </node>
      <node id="39409">
        <label>string</label>
      </node>
      <node id="39418">
        <label>table/block_builder.h</label>
        <link refid="block__builder_8h"/>
        <childnode refid="39415" relation="include">
        </childnode>
        <childnode refid="39405" relation="include">
        </childnode>
        <childnode refid="39410" relation="include">
        </childnode>
      </node>
      <node id="39424">
        <label>util/crc32c.h</label>
        <link refid="crc32c_8h"/>
        <childnode refid="39407" relation="include">
        </childnode>
        <childnode refid="39405" relation="include">
        </childnode>
      </node>
      <node id="39407">
        <label>stddef.h</label>
      </node>
      <node id="39408">
        <label>leveldb/status.h</label>
        <link refid="status_8h"/>
        <childnode refid="39409" relation="include">
        </childnode>
        <childnode refid="39410" relation="include">
        </childnode>
      </node>
      <node id="39422">
        <label>util/coding.h</label>
        <link refid="coding_8h"/>
        <childnode refid="39405" relation="include">
        </childnode>
        <childnode refid="39412" relation="include">
        </childnode>
        <childnode refid="39409" relation="include">
        </childnode>
        <childnode refid="39410" relation="include">
        </childnode>
        <childnode refid="39423" relation="include">
        </childnode>
      </node>
      <node id="39419">
        <label>table/filter_block.h</label>
        <link refid="filter__block_8h"/>
        <childnode refid="39407" relation="include">
        </childnode>
        <childnode refid="39405" relation="include">
        </childnode>
        <childnode refid="39409" relation="include">
        </childnode>
        <childnode refid="39415" relation="include">
        </childnode>
        <childnode refid="39410" relation="include">
        </childnode>
        <childnode refid="39420" relation="include">
        </childnode>
      </node>
      <node id="39412">
        <label>string.h</label>
      </node>
      <node id="39415">
        <label>vector</label>
      </node>
      <node id="39423">
        <label>port/port.h</label>
        <link refid="port_8h"/>
        <childnode refid="39412" relation="include">
        </childnode>
      </node>
      <node id="39405">
        <label>stdint.h</label>
        <link refid="stdint_8h"/>
      </node>
      <node id="39404">
        <label>leveldb/table_builder.h</label>
        <link refid="table__builder_8h"/>
        <childnode refid="39405" relation="include">
        </childnode>
        <childnode refid="39406" relation="include">
        </childnode>
        <childnode refid="39408" relation="include">
        </childnode>
      </node>
      <node id="39410">
        <label>leveldb/slice.h</label>
        <link refid="slice_8h"/>
        <childnode refid="39411" relation="include">
        </childnode>
        <childnode refid="39407" relation="include">
        </childnode>
        <childnode refid="39412" relation="include">
        </childnode>
        <childnode refid="39409" relation="include">
        </childnode>
      </node>
      <node id="39421">
        <label>table/format.h</label>
        <link refid="format_8h"/>
        <childnode refid="39409" relation="include">
        </childnode>
        <childnode refid="39405" relation="include">
        </childnode>
        <childnode refid="39410" relation="include">
        </childnode>
        <childnode refid="39408" relation="include">
        </childnode>
        <childnode refid="39404" relation="include">
        </childnode>
      </node>
      <node id="39414">
        <label>leveldb/env.h</label>
        <link refid="env_8h"/>
        <childnode refid="39409" relation="include">
        </childnode>
        <childnode refid="39415" relation="include">
        </childnode>
        <childnode refid="39416" relation="include">
        </childnode>
        <childnode refid="39405" relation="include">
        </childnode>
        <childnode refid="39408" relation="include">
        </childnode>
      </node>
      <node id="39420">
        <label>util/hash.h</label>
        <link refid="leveldb_2util_2hash_8h"/>
        <childnode refid="39407" relation="include">
        </childnode>
        <childnode refid="39405" relation="include">
        </childnode>
      </node>
      <node id="39417">
        <label>leveldb/filter_policy.h</label>
        <link refid="filter__policy_8h"/>
        <childnode refid="39409" relation="include">
        </childnode>
      </node>
      <node id="39413">
        <label>leveldb/comparator.h</label>
        <link refid="comparator_8h"/>
        <childnode refid="39409" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <innerclass refid="structleveldb_1_1_table_builder_1_1_rep" prot="public">leveldb::TableBuilder::Rep</innerclass>
    <innernamespace refid="namespaceleveldb">leveldb</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2011-2016<sp/>The<sp/>LevelDB<sp/>Authors.<sp/>All<sp/>rights<sp/>reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Use<sp/>of<sp/>this<sp/>source<sp/>code<sp/>is<sp/>governed<sp/>by<sp/>a<sp/>BSD-style<sp/>license<sp/>that<sp/>can<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>found<sp/>in<sp/>the<sp/>LICENSE<sp/>file.<sp/>See<sp/>the<sp/>AUTHORS<sp/>file<sp/>for<sp/>names<sp/>of<sp/>contributors.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="table__builder_8h" kindref="compound">leveldb/table_builder.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;assert.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="comparator_8h" kindref="compound">leveldb/comparator.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="env_8h" kindref="compound">leveldb/env.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="filter__policy_8h" kindref="compound">leveldb/filter_policy.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="options_8h" kindref="compound">leveldb/options.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="block__builder_8h" kindref="compound">table/block_builder.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="filter__block_8h" kindref="compound">table/filter_block.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="format_8h" kindref="compound">table/format.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="coding_8h" kindref="compound">util/coding.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="crc32c_8h" kindref="compound">util/crc32c.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceleveldb" kindref="compound">leveldb</ref><sp/>{</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20" refid="structleveldb_1_1_table_builder_1_1_rep" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structleveldb_1_1_table_builder_1_1_rep" kindref="compound">TableBuilder::Rep</ref><sp/>{</highlight></codeline>
<codeline lineno="21" refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_options" kindref="compound">Options</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>;</highlight></codeline>
<codeline lineno="22" refid="structleveldb_1_1_table_builder_1_1_rep_1a3ae22fe880ca1b98c3a7e24c1ec72c98" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_options" kindref="compound">Options</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a3ae22fe880ca1b98c3a7e24c1ec72c98" kindref="member">index_block_options</ref>;</highlight></codeline>
<codeline lineno="23" refid="structleveldb_1_1_table_builder_1_1_rep_1a3c33014db181b382785784cf0864f92b" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_writable_file" kindref="compound">WritableFile</ref>*<sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a3c33014db181b382785784cf0864f92b" kindref="member">file</ref>;</highlight></codeline>
<codeline lineno="24" refid="structleveldb_1_1_table_builder_1_1_rep_1a308abc45d45b23d05a0764f6fc501c40" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a308abc45d45b23d05a0764f6fc501c40" kindref="member">offset</ref>;</highlight></codeline>
<codeline lineno="25" refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_status" kindref="compound">Status</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref>;</highlight></codeline>
<codeline lineno="26" refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_block_builder" kindref="compound">BlockBuilder</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" kindref="member">data_block</ref>;</highlight></codeline>
<codeline lineno="27" refid="structleveldb_1_1_table_builder_1_1_rep_1a7d5740122ca84239cb009d513cf14681" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_block_builder" kindref="compound">BlockBuilder</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a7d5740122ca84239cb009d513cf14681" kindref="member">index_block</ref>;</highlight></codeline>
<codeline lineno="28" refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" refkind="member"><highlight class="normal"><sp/><sp/>std::string<sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>;</highlight></codeline>
<codeline lineno="29" refid="structleveldb_1_1_table_builder_1_1_rep_1a89f93baffb3ca5c8239796dc1a57777a" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="stdint_8h_1adec1df1b8b51cb32b77e5b86fff46471" kindref="member">int64_t</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a89f93baffb3ca5c8239796dc1a57777a" kindref="member">num_entries</ref>;</highlight></codeline>
<codeline lineno="30" refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Either<sp/>Finish()<sp/>or<sp/>Abandon()<sp/>has<sp/>been<sp/>called.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31" refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_filter_block_builder" kindref="compound">FilterBlockBuilder</ref>*<sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref>;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>do<sp/>not<sp/>emit<sp/>the<sp/>index<sp/>entry<sp/>for<sp/>a<sp/>block<sp/>until<sp/>we<sp/>have<sp/>seen<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>key<sp/>for<sp/>the<sp/>next<sp/>data<sp/>block.<sp/><sp/>This<sp/>allows<sp/>us<sp/>to<sp/>use<sp/>shorter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>keys<sp/>in<sp/>the<sp/>index<sp/>block.<sp/><sp/>For<sp/>example,<sp/>consider<sp/>a<sp/>block<sp/>boundary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>between<sp/>the<sp/>keys<sp/>&quot;the<sp/>quick<sp/>brown<sp/>fox&quot;<sp/>and<sp/>&quot;the<sp/>who&quot;.<sp/><sp/>We<sp/>can<sp/>use</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>&quot;the<sp/>r&quot;<sp/>as<sp/>the<sp/>key<sp/>for<sp/>the<sp/>index<sp/>block<sp/>entry<sp/>since<sp/>it<sp/>is<sp/>&gt;=<sp/>all</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>entries<sp/>in<sp/>the<sp/>first<sp/>block<sp/>and<sp/>&lt;<sp/>all<sp/>entries<sp/>in<sp/>subsequent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>blocks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Invariant:<sp/>r-&gt;pending_index_entry<sp/>is<sp/>true<sp/>only<sp/>if<sp/>data_block<sp/>is<sp/>empty.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42" refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref>;</highlight></codeline>
<codeline lineno="43" refid="structleveldb_1_1_table_builder_1_1_rep_1abf3b47f6f2b7407399c7134ac65f7225" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_block_handle" kindref="compound">BlockHandle</ref><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1abf3b47f6f2b7407399c7134ac65f7225" kindref="member">pending_handle</ref>;<sp/><sp/></highlight><highlight class="comment">//<sp/>Handle<sp/>to<sp/>add<sp/>to<sp/>index<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="structleveldb_1_1_table_builder_1_1_rep_1ae299e513afc71a8474c303b25aaadb08" refkind="member"><highlight class="normal"><sp/><sp/>std::string<sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1ae299e513afc71a8474c303b25aaadb08" kindref="member">compressed_output</ref>;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47" refid="structleveldb_1_1_table_builder_1_1_rep_1a9d68c60c57e7336aa1fd10fc9f32213e" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep_1a9d68c60c57e7336aa1fd10fc9f32213e" kindref="member">Rep</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structleveldb_1_1_options" kindref="compound">Options</ref>&amp;<sp/>opt,<sp/><ref refid="classleveldb_1_1_writable_file" kindref="compound">WritableFile</ref>*<sp/>f)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>options(opt),</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index_block_options(opt),</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>file(f),</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset(0),</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data_block(&amp;options),</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index_block(&amp;index_block_options),</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_entries(0),</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>closed(false),</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filter_block(opt.filter_policy<sp/>==<sp/>NULL<sp/>?<sp/>NULL</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>new<sp/><ref refid="classleveldb_1_1_filter_block_builder" kindref="compound">FilterBlockBuilder</ref>(opt.filter_policy)),</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pending_index_entry(false)<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>index_block_options.<ref refid="structleveldb_1_1_options_1ac71d66ae44e481edc3922d3a139c30b4" kindref="member">block_restart_interval</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal">};</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63" refid="classleveldb_1_1_table_builder_1a7f5d99e06039848d9b342a4871b31cc6" refkind="member"><highlight class="normal"><ref refid="classleveldb_1_1_table_builder_1a7f5d99e06039848d9b342a4871b31cc6" kindref="member">TableBuilder::TableBuilder</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structleveldb_1_1_options" kindref="compound">Options</ref>&amp;<sp/>options,<sp/><ref refid="classleveldb_1_1_writable_file" kindref="compound">WritableFile</ref>*<sp/>file)</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>:<sp/>rep_(new<sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep" kindref="compound">Rep</ref>(options,<sp/>file))<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref><sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref>-&gt;<ref refid="classleveldb_1_1_filter_block_builder_1a766a753a200f7386196a68897e47c1c3" kindref="member">StartBlock</ref>(0);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal">}</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70" refid="classleveldb_1_1_table_builder_1aa166d9bae1402bf2e77f7c45469e715d" refkind="member"><highlight class="normal"><ref refid="classleveldb_1_1_table_builder_1aa166d9bae1402bf2e77f7c45469e715d" kindref="member">TableBuilder::~TableBuilder</ref>()<sp/>{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/>assert(rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref>);<sp/><sp/></highlight><highlight class="comment">//<sp/>Catch<sp/>errors<sp/>where<sp/>caller<sp/>forgot<sp/>to<sp/>call<sp/>Finish()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref>;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>rep_;</highlight></codeline>
<codeline lineno="74"><highlight class="normal">}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76" refid="classleveldb_1_1_table_builder_1a6e37a5ddc82161e8665f2fba08031c24" refkind="member"><highlight class="normal"><ref refid="classleveldb_1_1_status" kindref="compound">Status</ref><sp/><ref refid="classleveldb_1_1_table_builder_1a6e37a5ddc82161e8665f2fba08031c24" kindref="member">TableBuilder::ChangeOptions</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structleveldb_1_1_options" kindref="compound">Options</ref>&amp;<sp/>options)<sp/>{</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Note:<sp/>if<sp/>more<sp/>fields<sp/>are<sp/>added<sp/>to<sp/>Options,<sp/>update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>function<sp/>to<sp/>catch<sp/>changes<sp/>that<sp/>should<sp/>not<sp/>be<sp/>allowed<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>in<sp/>the<sp/>middle<sp/>of<sp/>building<sp/>a<sp/>Table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(options.<ref refid="structleveldb_1_1_options_1a7522fbf79de73c4f73ef8d9392e8c80b" kindref="member">comparator</ref><sp/>!=<sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>.<ref refid="structleveldb_1_1_options_1a7522fbf79de73c4f73ef8d9392e8c80b" kindref="member">comparator</ref>)<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_status_1aefef9f88d0a6ca6d34bd9dec1670309e" kindref="member">Status::InvalidArgument</ref>(</highlight><highlight class="stringliteral">&quot;changing<sp/>comparator<sp/>while<sp/>building<sp/>table&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Note<sp/>that<sp/>any<sp/>live<sp/>BlockBuilders<sp/>point<sp/>to<sp/>rep_-&gt;options<sp/>and<sp/>therefore</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>will<sp/>automatically<sp/>pick<sp/>up<sp/>the<sp/>updated<sp/>options.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref><sp/>=<sp/>options;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a3ae22fe880ca1b98c3a7e24c1ec72c98" kindref="member">index_block_options</ref><sp/>=<sp/>options;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a3ae22fe880ca1b98c3a7e24c1ec72c98" kindref="member">index_block_options</ref>.<ref refid="structleveldb_1_1_options_1ac71d66ae44e481edc3922d3a139c30b4" kindref="member">block_restart_interval</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_status_1a8e3720d233281c874a53c17e081f51b3" kindref="member">Status::OK</ref>();</highlight></codeline>
<codeline lineno="90"><highlight class="normal">}</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92" refid="classleveldb_1_1_table_builder_1a37bd347cb6340215475ac9b42dc19d10" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_table_builder_1a37bd347cb6340215475ac9b42dc19d10" kindref="member">TableBuilder::Add</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref>&amp;<sp/>key,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref>&amp;<sp/><ref refid="version__set_8cc_1a38c8b88c432e666ad10b0c5573e1160a" kindref="member">value</ref>)<sp/>{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep" kindref="compound">Rep</ref>*<sp/>r<sp/>=<sp/>rep_;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/>assert(!r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref>);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ok())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a89f93baffb3ca5c8239796dc1a57777a" kindref="member">num_entries</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>assert(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>.<ref refid="structleveldb_1_1_options_1a7522fbf79de73c4f73ef8d9392e8c80b" kindref="member">comparator</ref>-&gt;<ref refid="structleveldb_1_1_comparator_1a05dae6edcad3c7db23827c0233d74039" kindref="member">Compare</ref>(key,<sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>))<sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref>)<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>assert(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" kindref="member">data_block</ref>.<ref refid="classleveldb_1_1_block_builder_1ae8d2223984da12b810124688aa56fdcd" kindref="member">empty</ref>());</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>.<ref refid="structleveldb_1_1_options_1a7522fbf79de73c4f73ef8d9392e8c80b" kindref="member">comparator</ref>-&gt;<ref refid="structleveldb_1_1_comparator_1abdfe6076225e95b91ffd94f646063115" kindref="member">FindShortestSeparator</ref>(&amp;r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>,<sp/>key);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>handle_encoding;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1abf3b47f6f2b7407399c7134ac65f7225" kindref="member">pending_handle</ref>.<ref refid="classleveldb_1_1_block_handle_1a71aa041d686d43e66ab570fce1ac388e" kindref="member">EncodeTo</ref>(&amp;handle_encoding);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a7d5740122ca84239cb009d513cf14681" kindref="member">index_block</ref>.<ref refid="classleveldb_1_1_block_builder_1a17d0e23f1e7afcb874b22a0cb0b6cf17" kindref="member">Add</ref>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>,<sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref>(handle_encoding));</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref><sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref>-&gt;<ref refid="classleveldb_1_1_filter_block_builder_1a4fd9db735c5c72973cec62e4fd98137d" kindref="member">AddKey</ref>(key);</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>.assign(key.<ref refid="classleveldb_1_1_slice_1aa64861043d9deee6889461bf0593cf73" kindref="member">data</ref>(),<sp/>key.<ref refid="classleveldb_1_1_slice_1a947d3173f04f8a30553e89046daf91d5" kindref="member">size</ref>());</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a89f93baffb3ca5c8239796dc1a57777a" kindref="member">num_entries</ref>++;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" kindref="member">data_block</ref>.<ref refid="classleveldb_1_1_block_builder_1a17d0e23f1e7afcb874b22a0cb0b6cf17" kindref="member">Add</ref>(key,<sp/>value);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>estimated_block_size<sp/>=<sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" kindref="member">data_block</ref>.<ref refid="classleveldb_1_1_block_builder_1a836fd5dfd46b72d2438a7d59a984a72f" kindref="member">CurrentSizeEstimate</ref>();</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(estimated_block_size<sp/>&gt;=<sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>.<ref refid="structleveldb_1_1_options_1a715c7941b43db641e76e598aa9ab52a0" kindref="member">block_size</ref>)<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classleveldb_1_1_table_builder_1a544560b4c97cd382ba9b8e0ef69dacfa" kindref="member">Flush</ref>();</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal">}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123" refid="classleveldb_1_1_table_builder_1a544560b4c97cd382ba9b8e0ef69dacfa" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_table_builder_1a544560b4c97cd382ba9b8e0ef69dacfa" kindref="member">TableBuilder::Flush</ref>()<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep" kindref="compound">Rep</ref>*<sp/>r<sp/>=<sp/>rep_;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/>assert(!r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref>);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ok())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" kindref="member">data_block</ref>.<ref refid="classleveldb_1_1_block_builder_1ae8d2223984da12b810124688aa56fdcd" kindref="member">empty</ref>())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>assert(!r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref>);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/>WriteBlock(&amp;r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a6bef8b1271d88ec2d38aa7a0f9ae8a24" kindref="member">data_block</ref>,<sp/>&amp;r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1abf3b47f6f2b7407399c7134ac65f7225" kindref="member">pending_handle</ref>);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ok())<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref><sp/>=<sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a3c33014db181b382785784cf0864f92b" kindref="member">file</ref>-&gt;<ref refid="classleveldb_1_1_writable_file_1ab95759ad32f6a05b0ee4266969fa265e" kindref="member">Flush</ref>();</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref><sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref>-&gt;<ref refid="classleveldb_1_1_filter_block_builder_1a766a753a200f7386196a68897e47c1c3" kindref="member">StartBlock</ref>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a308abc45d45b23d05a0764f6fc501c40" kindref="member">offset</ref>);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="137"><highlight class="normal">}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>TableBuilder::WriteBlock(<ref refid="classleveldb_1_1_block_builder" kindref="compound">BlockBuilder</ref>*<sp/><ref refid="structblock__" kindref="compound">block</ref>,<sp/><ref refid="classleveldb_1_1_block_handle" kindref="compound">BlockHandle</ref>*<sp/>handle)<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>File<sp/>format<sp/>contains<sp/>a<sp/>sequence<sp/>of<sp/>blocks<sp/>where<sp/>each<sp/>block<sp/>has:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>block_data:<sp/>uint8[n]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>type:<sp/>uint8</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>crc:<sp/>uint32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>assert(ok());</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/>Rep*<sp/>r<sp/>=<sp/>rep_;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref><sp/>raw<sp/>=<sp/>block-&gt;<ref refid="classleveldb_1_1_block_builder_1ab345ab44def13fb180502e9637b28bcd" kindref="member">Finish</ref>();</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref><sp/>block_contents;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><ref refid="namespaceleveldb_1a047a8e77a76becb82bab4720994f6f9b" kindref="member">CompressionType</ref><sp/>type<sp/>=<sp/>r-&gt;options.compression;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO(postrelease):<sp/>Support<sp/>more<sp/>compression<sp/>options:<sp/>zlib?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(type)<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespaceleveldb_1a047a8e77a76becb82bab4720994f6f9baf76e1b293dd8aa0709003431de425552" kindref="member">kNoCompression</ref>:</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>block_contents<sp/>=<sp/>raw;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespaceleveldb_1a047a8e77a76becb82bab4720994f6f9bad0d4e00e3596bcc3b9bdfd970900a06e" kindref="member">kSnappyCompression</ref>:<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>std::string*<sp/>compressed<sp/>=<sp/>&amp;r-&gt;compressed_output;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceleveldb_1_1port_1ae6e60ac8eb298c7eef3bb70ded8c809f" kindref="member">port::Snappy_Compress</ref>(raw.<ref refid="classleveldb_1_1_slice_1aa64861043d9deee6889461bf0593cf73" kindref="member">data</ref>(),<sp/>raw.<ref refid="classleveldb_1_1_slice_1a947d3173f04f8a30553e89046daf91d5" kindref="member">size</ref>(),<sp/>compressed)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>compressed-&gt;size()<sp/>&lt;<sp/>raw.<ref refid="classleveldb_1_1_slice_1a947d3173f04f8a30553e89046daf91d5" kindref="member">size</ref>()<sp/>-<sp/>(raw.<ref refid="classleveldb_1_1_slice_1a947d3173f04f8a30553e89046daf91d5" kindref="member">size</ref>()<sp/>/<sp/>8u))<sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_contents<sp/>=<sp/>*compressed;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Snappy<sp/>not<sp/>supported,<sp/>or<sp/>compressed<sp/>less<sp/>than<sp/>12.5%,<sp/>so<sp/>just</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>store<sp/>uncompressed<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_contents<sp/>=<sp/>raw;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>type<sp/>=<sp/><ref refid="namespaceleveldb_1a047a8e77a76becb82bab4720994f6f9baf76e1b293dd8aa0709003431de425552" kindref="member">kNoCompression</ref>;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/>WriteRawBlock(block_contents,<sp/>type,<sp/>handle);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/>r-&gt;compressed_output.clear();</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/>block-&gt;<ref refid="classleveldb_1_1_block_builder_1a812168608c24de2dfa1651fcdd88e49b" kindref="member">Reset</ref>();</highlight></codeline>
<codeline lineno="173"><highlight class="normal">}</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>TableBuilder::WriteRawBlock(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Slice&amp;<sp/>block_contents,</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceleveldb_1a047a8e77a76becb82bab4720994f6f9b" kindref="member">CompressionType</ref><sp/>type,</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BlockHandle*<sp/>handle)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/>Rep*<sp/>r<sp/>=<sp/>rep_;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/>handle-&gt;set_offset(r-&gt;offset);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>handle-&gt;set_size(block_contents.size());</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref><sp/>=<sp/>r-&gt;file-&gt;Append(block_contents);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;status.ok())<sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>trailer[kBlockTrailerSize];</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>trailer[0]<sp/>=<sp/>type;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stdint_8h_1a435d1572bf3f880d55459d9805097f62" kindref="member">uint32_t</ref><sp/>crc<sp/>=<sp/><ref refid="namespaceleveldb_1_1crc32c_1ac004d1e3d8c75b033c162e5ae0a5cc2c" kindref="member">crc32c::Value</ref>(block_contents.data(),<sp/>block_contents.size());</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/>crc<sp/>=<sp/><ref refid="namespaceleveldb_1_1crc32c_1ac42fd0618afe635356d722fd29f5ff10" kindref="member">crc32c::Extend</ref>(crc,<sp/>trailer,<sp/>1);<sp/><sp/></highlight><highlight class="comment">//<sp/>Extend<sp/>crc<sp/>to<sp/>cover<sp/>block<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceleveldb_1a265d1eea2e5d8e42cf86372ed4904886" kindref="member">EncodeFixed32</ref>(trailer+1,<sp/><ref refid="namespaceleveldb_1_1crc32c_1a3790e1e939714a29609e46383aafd6cf" kindref="member">crc32c::Mask</ref>(crc));</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;status<sp/>=<sp/>r-&gt;file-&gt;Append(Slice(trailer,<sp/>kBlockTrailerSize));</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;status.ok())<sp/>{</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;offset<sp/>+=<sp/>block_contents.size()<sp/>+<sp/>kBlockTrailerSize;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal">}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195" refid="classleveldb_1_1_table_builder_1aaec88faf09425e9c229a69e34656bf80" refkind="member"><highlight class="normal"><ref refid="classleveldb_1_1_status" kindref="compound">Status</ref><sp/><ref refid="classleveldb_1_1_table_builder_1aaec88faf09425e9c229a69e34656bf80" kindref="member">TableBuilder::status</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref>;</highlight></codeline>
<codeline lineno="197"><highlight class="normal">}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199" refid="classleveldb_1_1_table_builder_1a88f4bae006782e24462362d489dd3f35" refkind="member"><highlight class="normal"><ref refid="classleveldb_1_1_status" kindref="compound">Status</ref><sp/><ref refid="classleveldb_1_1_table_builder_1a88f4bae006782e24462362d489dd3f35" kindref="member">TableBuilder::Finish</ref>()<sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep" kindref="compound">Rep</ref>*<sp/>r<sp/>=<sp/>rep_;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_table_builder_1a544560b4c97cd382ba9b8e0ef69dacfa" kindref="member">Flush</ref>();</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/>assert(!r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref>);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><ref refid="classleveldb_1_1_block_handle" kindref="compound">BlockHandle</ref><sp/>filter_block_handle,<sp/>metaindex_block_handle,<sp/>index_block_handle;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>filter<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ok()<sp/>&amp;&amp;<sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref><sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>WriteRawBlock(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref>-&gt;<ref refid="classleveldb_1_1_filter_block_builder_1a75fa127d8af42e749abdd235eed97cad" kindref="member">Finish</ref>(),<sp/><ref refid="namespaceleveldb_1a047a8e77a76becb82bab4720994f6f9baf76e1b293dd8aa0709003431de425552" kindref="member">kNoCompression</ref>,</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;filter_block_handle);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>metaindex<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ok())<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classleveldb_1_1_block_builder" kindref="compound">BlockBuilder</ref><sp/>meta_index_block(&amp;r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1aad1620ca746b7287a819880be083ec6b" kindref="member">filter_block</ref><sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>mapping<sp/>from<sp/>&quot;filter.Name&quot;<sp/>to<sp/>location<sp/>of<sp/>filter<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>std::string<sp/>key<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;filter.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>key.append(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>.<ref refid="structleveldb_1_1_options_1a24c88997a866d535e68de15b5c3cd02b" kindref="member">filter_policy</ref>-&gt;<ref refid="classleveldb_1_1_filter_policy_1afd5e951892a2e740f186c0658913ea1b" kindref="member">Name</ref>());</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>std::string<sp/>handle_encoding;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>filter_block_handle.<ref refid="classleveldb_1_1_block_handle_1a71aa041d686d43e66ab570fce1ac388e" kindref="member">EncodeTo</ref>(&amp;handle_encoding);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>meta_index_block.<ref refid="classleveldb_1_1_block_builder_1a17d0e23f1e7afcb874b22a0cb0b6cf17" kindref="member">Add</ref>(key,<sp/>handle_encoding);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO(postrelease):<sp/>Add<sp/>stats<sp/>and<sp/>other<sp/>meta<sp/>blocks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>WriteBlock(&amp;meta_index_block,<sp/>&amp;metaindex_block_handle);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>index<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ok())<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref>)<sp/>{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a0ca1914136ea4c451b026b4f1913fe36" kindref="member">options</ref>.<ref refid="structleveldb_1_1_options_1a7522fbf79de73c4f73ef8d9392e8c80b" kindref="member">comparator</ref>-&gt;<ref refid="structleveldb_1_1_comparator_1a49751dd906595633161dfad943d24b3b" kindref="member">FindShortSuccessor</ref>(&amp;r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>std::string<sp/>handle_encoding;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1abf3b47f6f2b7407399c7134ac65f7225" kindref="member">pending_handle</ref>.<ref refid="classleveldb_1_1_block_handle_1a71aa041d686d43e66ab570fce1ac388e" kindref="member">EncodeTo</ref>(&amp;handle_encoding);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a7d5740122ca84239cb009d513cf14681" kindref="member">index_block</ref>.<ref refid="classleveldb_1_1_block_builder_1a17d0e23f1e7afcb874b22a0cb0b6cf17" kindref="member">Add</ref>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5a071831c7e42011a40b04cb60cdfa09" kindref="member">last_key</ref>,<sp/><ref refid="classleveldb_1_1_slice" kindref="compound">Slice</ref>(handle_encoding));</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a56e14221a2e29941a37d208f99770c20" kindref="member">pending_index_entry</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>WriteBlock(&amp;r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a7d5740122ca84239cb009d513cf14681" kindref="member">index_block</ref>,<sp/>&amp;index_block_handle);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>footer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ok())<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classleveldb_1_1_footer" kindref="compound">Footer</ref><sp/>footer;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/>footer.<ref refid="classleveldb_1_1_footer_1ac937207010f61550c703b2d732422566" kindref="member">set_metaindex_handle</ref>(metaindex_block_handle);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>footer.<ref refid="classleveldb_1_1_footer_1ae2f4be5947f5e4983a160d6d01edea68" kindref="member">set_index_handle</ref>(index_block_handle);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>footer_encoding;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>footer.<ref refid="classleveldb_1_1_footer_1ac0148e441c2f25d7d24ec14ba2099f58" kindref="member">EncodeTo</ref>(&amp;footer_encoding);</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref><sp/>=<sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a3c33014db181b382785784cf0864f92b" kindref="member">file</ref>-&gt;<ref refid="classleveldb_1_1_writable_file_1a53b41841d9577d28f65d4d90e1660de8" kindref="member">Append</ref>(footer_encoding);</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref>.<ref refid="classleveldb_1_1_status_1ab31e89a858c766716e3dc952be857c65" kindref="member">ok</ref>())<sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a308abc45d45b23d05a0764f6fc501c40" kindref="member">offset</ref><sp/>+=<sp/>footer_encoding.size();</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a8345f0a97587121457fb180a1fb081dd" kindref="member">status</ref>;</highlight></codeline>
<codeline lineno="254"><highlight class="normal">}</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256" refid="classleveldb_1_1_table_builder_1a3b4dded079f960b8624bdfa13d967b94" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classleveldb_1_1_table_builder_1a3b4dded079f960b8624bdfa13d967b94" kindref="member">TableBuilder::Abandon</ref>()<sp/>{</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><ref refid="structleveldb_1_1_table_builder_1_1_rep" kindref="compound">Rep</ref>*<sp/>r<sp/>=<sp/>rep_;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/>assert(!r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref>);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a5324550d58b999bcea173b1c21060138" kindref="member">closed</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="260"><highlight class="normal">}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262" refid="classleveldb_1_1_table_builder_1a765e1dfcb4e12d0b56fd70e758d9a5c2" refkind="member"><highlight class="normal"><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref><sp/><ref refid="classleveldb_1_1_table_builder_1a765e1dfcb4e12d0b56fd70e758d9a5c2" kindref="member">TableBuilder::NumEntries</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a89f93baffb3ca5c8239796dc1a57777a" kindref="member">num_entries</ref>;</highlight></codeline>
<codeline lineno="264"><highlight class="normal">}</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266" refid="classleveldb_1_1_table_builder_1a5844a15a8f94d2c44da709937f29039c" refkind="member"><highlight class="normal"><ref refid="stdint_8h_1aaa5d1cd013383c889537491c3cfd9aad" kindref="member">uint64_t</ref><sp/><ref refid="classleveldb_1_1_table_builder_1a5844a15a8f94d2c44da709937f29039c" kindref="member">TableBuilder::FileSize</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rep_-&gt;<ref refid="structleveldb_1_1_table_builder_1_1_rep_1a308abc45d45b23d05a0764f6fc501c40" kindref="member">offset</ref>;</highlight></codeline>
<codeline lineno="268"><highlight class="normal">}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal">}<sp/><sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>leveldb</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/home/dev/ds-160209/src/leveldb/table/table_builder.cc"/>
  </compounddef>
</doxygen>
